<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="language" content="en" />
        
<link href="./assets/1728b664/css/bootstrap.css" rel="stylesheet">
<link href="./assets/9c5d0894/solarized_light.css" rel="stylesheet">
<link href="./assets/f2ce5bcd/style.css" rel="stylesheet">
<script src="./assets/bbf84a7a/jquery.js"></script>
<script src="./assets/1728b664/js/bootstrap.js"></script>
<script src="./assets/fd63b446/jssearch.js"></script>    <title>Сессии и куки - Обработка запросов - The Definitive Guide to Yii 2.0</title>
</head>
<body>

<div class="wrap">
    <nav id="w415" class="navbar-inverse navbar-fixed-top navbar"><div class="navbar-header"><button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#w415-collapse"><span class="sr-only">Toggle navigation</span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
<span class="icon-bar"></span></button><a class="navbar-brand" href="./index.html">The Definitive Guide to Yii 2.0</a></div><div id="w415-collapse" class="collapse navbar-collapse"><ul id="w416" class="navbar-nav nav"><li><a href="./index.html">Class reference</a></li>
<li class="dropdown"><a class="dropdown-toggle" href="#" data-toggle="dropdown">Extensions <span class="caret"></span></a><ul id="w417" class="dropdown-menu"><li><a href="./ext-apidoc-index.html" tabindex="-1">apidoc</a></li>
<li><a href="./ext-authclient-index.html" tabindex="-1">authclient</a></li>
<li><a href="./ext-bootstrap-index.html" tabindex="-1">bootstrap</a></li>
<li><a href="./ext-debug-index.html" tabindex="-1">debug</a></li>
<li><a href="./ext-elasticsearch-index.html" tabindex="-1">elasticsearch</a></li>
<li><a href="./ext-faker-index.html" tabindex="-1">faker</a></li>
<li><a href="./ext-gii-index.html" tabindex="-1">gii</a></li>
<li><a href="./ext-httpclient-index.html" tabindex="-1">httpclient</a></li>
<li><a href="./ext-imagine-index.html" tabindex="-1">imagine</a></li>
<li><a href="./ext-jui-index.html" tabindex="-1">jui</a></li>
<li><a href="./ext-mongodb-index.html" tabindex="-1">mongodb</a></li>
<li><a href="./ext-redis-index.html" tabindex="-1">redis</a></li>
<li><a href="./ext-shell-index.html" tabindex="-1">shell</a></li>
<li><a href="./ext-smarty-index.html" tabindex="-1">smarty</a></li>
<li><a href="./ext-sphinx-index.html" tabindex="-1">sphinx</a></li>
<li><a href="./ext-swiftmailer-index.html" tabindex="-1">swiftmailer</a></li>
<li><a href="./ext-twig-index.html" tabindex="-1">twig</a></li></ul></li>
<li><a href="./guide-README.html">Guide</a></li></ul><div class="navbar-form navbar-left" role="search">
  <div class="form-group">
    <input id="searchbox" type="text" class="form-control" placeholder="Search">
  </div>
</div>
</div></nav>
    <div id="search-resultbox" style="display: none;" class="modal-content">
        <ul id="search-results">
        </ul>
    </div>

    
<div class="row">
    <div class="col-md-2">
                <div id="navigation" class="list-group"><a class="list-group-item" href="#navigation-399" data-toggle="collapse" data-parent="#navigation">Введение <b class="caret"></b></a><div id="navigation-399" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-intro-yii.html">О Yii</a>
<a class="list-group-item" href="./guide-intro-upgrade-from-v1.html">Обновление с версии 1.1</a></div>
<a class="list-group-item" href="#navigation-400" data-toggle="collapse" data-parent="#navigation">Первое знакомство <b class="caret"></b></a><div id="navigation-400" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-start-installation.html">Установка Yii</a>
<a class="list-group-item" href="./guide-start-workflow.html">Запуск приложения</a>
<a class="list-group-item" href="./guide-start-hello.html">Говорим «привет»</a>
<a class="list-group-item" href="./guide-start-forms.html">Работа с формами</a>
<a class="list-group-item" href="./guide-start-databases.html">Работа с базами данных</a>
<a class="list-group-item" href="./guide-start-gii.html">Генерация кода при помощи Gii</a>
<a class="list-group-item" href="./guide-start-looking-ahead.html">Что дальше?</a></div>
<a class="list-group-item" href="#navigation-401" data-toggle="collapse" data-parent="#navigation">Структура приложения <b class="caret"></b></a><div id="navigation-401" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-structure-overview.html">Обзор</a>
<a class="list-group-item" href="./guide-structure-entry-scripts.html">Входные скрипты</a>
<a class="list-group-item" href="./guide-structure-applications.html">Приложения</a>
<a class="list-group-item" href="./guide-structure-application-components.html">Компоненты приложения</a>
<a class="list-group-item" href="./guide-structure-controllers.html">Контроллеры</a>
<a class="list-group-item" href="./guide-structure-models.html">Модели</a>
<a class="list-group-item" href="./guide-structure-views.html">Представления</a>
<a class="list-group-item" href="./guide-structure-modules.html">Модули</a>
<a class="list-group-item" href="./guide-structure-filters.html">Фильтры</a>
<a class="list-group-item" href="./guide-structure-widgets.html">Виджеты</a>
<a class="list-group-item" href="./guide-structure-assets.html">Ресурсы</a>
<a class="list-group-item" href="./guide-structure-extensions.html">Расширения</a></div>
<a class="list-group-item active" href="#navigation-402" data-toggle="collapse" data-parent="#navigation">Обработка запросов <b class="caret"></b></a><div id="navigation-402" class="submenu panel-collapse collapse in"><a class="list-group-item" href="./guide-runtime-overview.html">Обзор</a>
<a class="list-group-item" href="./guide-runtime-bootstrapping.html">Bootstrapping</a>
<a class="list-group-item" href="./guide-runtime-routing.html">Разбор и генерация URL</a>
<a class="list-group-item" href="./guide-runtime-requests.html">Запросы</a>
<a class="list-group-item" href="./guide-runtime-responses.html">Ответы</a>
<a class="list-group-item active" href="./guide-runtime-sessions-cookies.html">Сессии и куки</a>
<a class="list-group-item" href="./guide-runtime-handling-errors.html">Обработка ошибок</a>
<a class="list-group-item" href="./guide-runtime-logging.html">Логирование</a></div>
<a class="list-group-item" href="#navigation-403" data-toggle="collapse" data-parent="#navigation">Основные понятия <b class="caret"></b></a><div id="navigation-403" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-concept-components.html">Компоненты</a>
<a class="list-group-item" href="./guide-concept-properties.html">Свойства</a>
<a class="list-group-item" href="./guide-concept-events.html">События</a>
<a class="list-group-item" href="./guide-concept-behaviors.html">Поведения</a>
<a class="list-group-item" href="./guide-concept-configurations.html">Конфигурации</a>
<a class="list-group-item" href="./guide-concept-aliases.html">Псевдонимы</a>
<a class="list-group-item" href="./guide-concept-autoloading.html">Автозагрузка классов</a>
<a class="list-group-item" href="./guide-concept-service-locator.html">Service Locator</a>
<a class="list-group-item" href="./guide-concept-di-container.html">Dependency Injection Container</a></div>
<a class="list-group-item" href="#navigation-404" data-toggle="collapse" data-parent="#navigation">Работа с базами данных <b class="caret"></b></a><div id="navigation-404" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-db-dao.html">Объекты доступа к данным (DAO)</a>
<a class="list-group-item" href="./guide-db-query-builder.html">Построитель запросов</a>
<a class="list-group-item" href="./guide-db-active-record.html">Active Record</a>
<a class="list-group-item" href="./guide-db-migrations.html">Миграции</a>
<a class="list-group-item" href="https://github.com/yiisoft/yii2-sphinx/blob/master/docs/guide-ru/README.md">Sphinx</a>
<a class="list-group-item" href="https://github.com/yiisoft/yii2-redis/blob/master/docs/guide-ru/README.md">Redis</a>
<a class="list-group-item" href="https://github.com/yiisoft/yii2-mongodb/blob/master/docs/guide-ru/README.md">MongoDB</a>
<a class="list-group-item" href="https://github.com/yiisoft/yii2-elasticsearch/blob/master/docs/guide-ru/README.md">ElasticSearch</a></div>
<a class="list-group-item" href="#navigation-405" data-toggle="collapse" data-parent="#navigation">Получение данных от пользователя <b class="caret"></b></a><div id="navigation-405" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-input-forms.html">Создание форм</a>
<a class="list-group-item" href="./guide-input-validation.html">Валидация</a>
<a class="list-group-item" href="./guide-input-file-upload.html">Загрузка файлов</a>
<a class="list-group-item" href="./guide-input-tabular-input.html">Табличный ввод</a>
<a class="list-group-item" href="./guide-input-multiple-models.html">Работа с несколькими моделями</a>
<a class="list-group-item" href="./guide-input-form-javascript.html">Расширение ActiveForm на стороне клиента</a></div>
<a class="list-group-item" href="#navigation-406" data-toggle="collapse" data-parent="#navigation">Отображение данных <b class="caret"></b></a><div id="navigation-406" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-output-formatting.html">Форматирование данных</a>
<a class="list-group-item" href="./guide-output-pagination.html">Постраничная разбивка</a>
<a class="list-group-item" href="./guide-output-sorting.html">Сортировка</a>
<a class="list-group-item" href="./guide-output-data-providers.html">Провайдеры данных</a>
<a class="list-group-item" href="./guide-output-data-widgets.html">Виджеты для данных</a>
<a class="list-group-item" href="./guide-output-client-scripts.html">Работа с клиентскими скриптами</a>
<a class="list-group-item" href="./guide-output-theming.html">Темизация</a></div>
<a class="list-group-item" href="#navigation-407" data-toggle="collapse" data-parent="#navigation">Безопасность <b class="caret"></b></a><div id="navigation-407" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-security-overview.html">Обзор</a>
<a class="list-group-item" href="./guide-security-authentication.html">Аутентификация</a>
<a class="list-group-item" href="./guide-security-authorization.html">Авторизация</a>
<a class="list-group-item" href="./guide-security-passwords.html">Работа с паролями</a>
<a class="list-group-item" href="./guide-security-cryptography.html">Криптография</a>
<a class="list-group-item" href="https://github.com/yiisoft/yii2-authclient/blob/master/docs/guide-ru/README.md">Клиенты авторизации</a>
<a class="list-group-item" href="./guide-security-best-practices.html">Лучшие практики</a></div>
<a class="list-group-item" href="#navigation-408" data-toggle="collapse" data-parent="#navigation">Кеширование <b class="caret"></b></a><div id="navigation-408" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-caching-overview.html">Обзор</a>
<a class="list-group-item" href="./guide-caching-data.html">Кэширование данных</a>
<a class="list-group-item" href="./guide-caching-fragment.html">Кэширование фрагментов</a>
<a class="list-group-item" href="./guide-caching-page.html">Кэширование страниц</a>
<a class="list-group-item" href="./guide-caching-http.html">HTTP кэширование</a></div>
<a class="list-group-item" href="#navigation-409" data-toggle="collapse" data-parent="#navigation">Веб-сервисы REST <b class="caret"></b></a><div id="navigation-409" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-rest-quick-start.html">Быстрый старт</a>
<a class="list-group-item" href="./guide-rest-resources.html">Ресурсы</a>
<a class="list-group-item" href="./guide-rest-controllers.html">Контроллеры</a>
<a class="list-group-item" href="./guide-rest-routing.html">Роутинг</a>
<a class="list-group-item" href="./guide-rest-response-formatting.html">Форматирование ответа</a>
<a class="list-group-item" href="./guide-rest-authentication.html">Аутентификация</a>
<a class="list-group-item" href="./guide-rest-rate-limiting.html">Ограничение частоты запросов</a>
<a class="list-group-item" href="./guide-rest-versioning.html">Версионирование</a>
<a class="list-group-item" href="./guide-rest-error-handling.html">Обработка ошибок</a></div>
<a class="list-group-item" href="#navigation-410" data-toggle="collapse" data-parent="#navigation">Инструменты разработчика <b class="caret"></b></a><div id="navigation-410" class="submenu panel-collapse collapse"><a class="list-group-item" href="https://github.com/yiisoft/yii2-debug/blob/master/docs/guide/README.md">Отладочная панель и отладчик</a>
<a class="list-group-item" href="https://github.com/yiisoft/yii2-gii/blob/master/docs/guide/README.md">Генерация кода с Gii</a>
<a class="list-group-item" href="https://github.com/yiisoft/yii2-apidoc">Генератор документации API</a></div>
<a class="list-group-item" href="#navigation-411" data-toggle="collapse" data-parent="#navigation">Тестирование <b class="caret"></b></a><div id="navigation-411" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-test-overview.html">Обзор</a>
<a class="list-group-item" href="./guide-test-environment-setup.html">Настройка тестового окружения</a>
<a class="list-group-item" href="./guide-test-unit.html">Модульные тесты</a>
<a class="list-group-item" href="./guide-test-functional.html">Функциональные тесты</a>
<a class="list-group-item" href="./guide-test-acceptance.html">Приёмочные тесты</a>
<a class="list-group-item" href="./guide-test-fixtures.html">Фикстуры</a></div>
<a class="list-group-item" href="#navigation-412" data-toggle="collapse" data-parent="#navigation">Специальные темы <b class="caret"></b></a><div id="navigation-412" class="submenu panel-collapse collapse"><a class="list-group-item" href="https://github.com/yiisoft/yii2-app-advanced/blob/master/docs/guide/README.md">Шаблон приложения advanced</a>
<a class="list-group-item" href="./guide-tutorial-start-from-scratch.html">Создание приложения с нуля</a>
<a class="list-group-item" href="./guide-tutorial-console.html">Консольные команды</a>
<a class="list-group-item" href="./guide-tutorial-core-validators.html">Встроенные валидаторы</a>
<a class="list-group-item" href="./guide-tutorial-i18n.html">Интернационализация</a>
<a class="list-group-item" href="./guide-tutorial-mailing.html">Отправка почты</a>
<a class="list-group-item" href="./guide-tutorial-performance-tuning.html">Оптимизация производительности</a>
<a class="list-group-item" href="./guide-tutorial-shared-hosting.html">Окружение виртуального хостинга</a>
<a class="list-group-item" href="./guide-tutorial-template-engines.html">Шаблонизаторы</a>
<a class="list-group-item" href="./guide-tutorial-yii-integration.html">Работа со сторонним кодом</a>
<a class="list-group-item" href="./guide-tutorial-yii-as-micro-framework.html">Использование Yii в качестве микро-framework&#039;а</a></div>
<a class="list-group-item" href="#navigation-413" data-toggle="collapse" data-parent="#navigation">Виджеты <b class="caret"></b></a><div id="navigation-413" class="submenu panel-collapse collapse"><a class="list-group-item" href="http://www.yiiframework.com/doc-2.0/yii-grid-gridview.html">GridView</a>
<a class="list-group-item" href="http://www.yiiframework.com/doc-2.0/yii-widgets-listview.html">ListView</a>
<a class="list-group-item" href="http://www.yiiframework.com/doc-2.0/yii-widgets-detailview.html">DetailView</a>
<a class="list-group-item" href="http://www.yiiframework.com/doc-2.0/guide-input-forms.html#activerecord-based-forms-activeform">ActiveForm</a>
<a class="list-group-item" href="http://www.yiiframework.com/doc-2.0/yii-widgets-pjax.html">Pjax</a>
<a class="list-group-item" href="http://www.yiiframework.com/doc-2.0/yii-widgets-menu.html">Menu</a>
<a class="list-group-item" href="http://www.yiiframework.com/doc-2.0/yii-widgets-linkpager.html">LinkPager</a>
<a class="list-group-item" href="http://www.yiiframework.com/doc-2.0/yii-widgets-linksorter.html">LinkSorter</a>
<a class="list-group-item" href="https://github.com/yiisoft/yii2-bootstrap/blob/master/docs/guide-ru/README.md">Виджеты Bootstrap</a>
<a class="list-group-item" href="https://github.com/yiisoft/yii2-jui/blob/master/docs/guide-ru/README.md">Виджеты Jquery UI</a></div>
<a class="list-group-item" href="#navigation-414" data-toggle="collapse" data-parent="#navigation">Хелперы <b class="caret"></b></a><div id="navigation-414" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-helper-overview.html">Обзор</a>
<a class="list-group-item" href="./guide-helper-array.html">ArrayHelper</a>
<a class="list-group-item" href="./guide-helper-html.html">Html</a>
<a class="list-group-item" href="./guide-helper-url.html">Url хелпер</a></div></div>    </div>
    <div class="col-md-9 guide-content" role="main">
        <h1>Сессии и куки <span id="sessii-i-kuki"></span><a href="#sessii-i-kuki" class="hashlink">&para;</a></h1>
<div class="toc"><ol><li><a href="#sessions">Сессии</a></li>
<li><a href="#cookies">Куки</a></li></ol></div>
<p>Сессии и куки позволяют сохранять пользовательские данные между запросами. При использовании чистого PHP можно получить доступ к этим данным через глобальные переменные <code>$_SESSION</code> и <code>$_COOKIE</code>, соответственно. Yii инкапсулирует сессии и куки в объекты, что дает возможность обращаться к ним в объектно-ориентированном стиле и дает дополнительное удобство в работе.</p>
<h2>Сессии  <span id="sessions"></span><a href="#sessions" class="hashlink">&para;</a></h2><p>По аналогии с <a href="guide-runtime-requests.html">запросами</a> и <a href="guide-runtime-responses.html">ответами</a>, к сессии можно получить доступ через <code>session</code> <a href="guide-structure-application-components.html">компонент приложения</a>, который по умолчанию является экземпляром <a href="./yii-web-session.html">yii\web\Session</a>.</p>
<h3>Открытие и закрытие сессии  <span id="opening-closing-sessions"></span><a href="#opening-closing-sessions" class="hashlink">&para;</a></h3><p>Открыть и закрыть сессию можно следующим образом:</p>
<pre><code class="hljs php language-php">$session = Yii::$app-&gt;session;

<span class="hljs-comment">// проверяем что сессия уже открыта</span>
<span class="hljs-keyword">if</span> ($session-&gt;isActive) ...

<span class="hljs-comment">// открываем сессию</span>
$session-&gt;open();

<span class="hljs-comment">// закрываем сессию</span>
$session-&gt;close();

<span class="hljs-comment">// уничтожаем сессию и все связанные с ней данные.</span>
$session-&gt;destroy();
</code></pre>
<p>Можно вызывать <a href="./yii-web-session.html#open()-detail">open()</a> и <a href="./yii-web-session.html#close()-detail">close()</a> многократно без возникновения ошибок; внутри компонента все методы проверяют сессию на факт того, открыта она или нет.</p>
<h3>Доступ к данным сессии  <span id="access-session-data"></span><a href="#access-session-data" class="hashlink">&para;</a></h3><p>Получить доступ к сохраненным в сессию данным можно следующим образом:</p>
<pre><code class="hljs php language-php">$session = Yii::$app-&gt;session;

<span class="hljs-comment">// получение переменной из сессии. Следующие способы использования эквивалентны:</span>
$language = $session-&gt;get(<span class="hljs-string">'language'</span>);
$language = $session[<span class="hljs-string">'language'</span>];
$language = <span class="hljs-keyword">isset</span>($_SESSION[<span class="hljs-string">'language'</span>]) ? $_SESSION[<span class="hljs-string">'language'</span>] : <span class="hljs-keyword">null</span>;

<span class="hljs-comment">// запись переменной в сессию. Следующие способы использования эквивалентны:</span>
$session-&gt;set(<span class="hljs-string">'language'</span>, <span class="hljs-string">'en-US'</span>);
$session[<span class="hljs-string">'language'</span>] = <span class="hljs-string">'en-US'</span>;
$_SESSION[<span class="hljs-string">'language'</span>] = <span class="hljs-string">'en-US'</span>;

<span class="hljs-comment">// Удаление переменной из сессии. Следующие способы использования эквивалентны:</span>
$session-&gt;remove(<span class="hljs-string">'language'</span>);
<span class="hljs-keyword">unset</span>($session[<span class="hljs-string">'language'</span>]);
<span class="hljs-keyword">unset</span>($_SESSION[<span class="hljs-string">'language'</span>]);

<span class="hljs-comment">// проверка на существование переменной в сессии. Следующие способы использования эквивалентны:</span>
<span class="hljs-keyword">if</span> ($session-&gt;has(<span class="hljs-string">'language'</span>)) ...
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>($session[<span class="hljs-string">'language'</span>])) ...
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>($_SESSION[<span class="hljs-string">'language'</span>])) ...

<span class="hljs-comment">// Обход всех переменных в сессии. Следующие способы использования эквивалентны:</span>
<span class="hljs-keyword">foreach</span> ($session <span class="hljs-keyword">as</span> $name =&gt; $value) ...
<span class="hljs-keyword">foreach</span> ($_SESSION <span class="hljs-keyword">as</span> $name =&gt; $value) ...
</code></pre>
<blockquote class="info"><p><strong>Информация: </strong>При получении данных из сессии через компонент <code>session</code>, сессия будет автоматически открыта, если она не была открыта до этого. В этом заключается отличие от получения данных из глобальной переменной <code>$_SESSION</code>, которое требует обязательного вызова  <code>session_start()</code>.</p>
</blockquote>
<p>При работе с сессионными данными, являющимися массивами, компонент <code>session</code> имеет ограничение, запрещающее прямую модификацию отдельных элементов массива. Например,</p>
<pre><code class="hljs php language-php">$session = Yii::$app-&gt;session;

<span class="hljs-comment">// следующий код НЕ БУДЕТ работать</span>
$session[<span class="hljs-string">'captcha'</span>][<span class="hljs-string">'number'</span>] = <span class="hljs-number">5</span>;
$session[<span class="hljs-string">'captcha'</span>][<span class="hljs-string">'lifetime'</span>] = <span class="hljs-number">3600</span>;

<span class="hljs-comment">// а этот будет:</span>
$session[<span class="hljs-string">'captcha'</span>] = [
    <span class="hljs-string">'number'</span> =&gt; <span class="hljs-number">5</span>,
    <span class="hljs-string">'lifetime'</span> =&gt; <span class="hljs-number">3600</span>,
];

<span class="hljs-comment">// этот код также будет работать:</span>
<span class="hljs-keyword">echo</span> $session[<span class="hljs-string">'captcha'</span>][<span class="hljs-string">'lifetime'</span>];
</code></pre>
<p>Для решения этой проблемы можно использовать следующие обходные приемы:</p>
<pre><code class="hljs php language-php">$session = Yii::$app-&gt;session;

<span class="hljs-comment">// прямое использование $_SESSION (убедитесь, что Yii::$app-&gt;session-&gt;open() был вызван)</span>
$_SESSION[<span class="hljs-string">'captcha'</span>][<span class="hljs-string">'number'</span>] = <span class="hljs-number">5</span>;
$_SESSION[<span class="hljs-string">'captcha'</span>][<span class="hljs-string">'lifetime'</span>] = <span class="hljs-number">3600</span>;

<span class="hljs-comment">// получите весь массив, модифицируйте и сохраните обратно в сессию</span>
$captcha = $session[<span class="hljs-string">'captcha'</span>];
$captcha[<span class="hljs-string">'number'</span>] = <span class="hljs-number">5</span>;
$captcha[<span class="hljs-string">'lifetime'</span>] = <span class="hljs-number">3600</span>;
$session[<span class="hljs-string">'captcha'</span>] = $captcha;

<span class="hljs-comment">// используйте ArrayObject вместо массива</span>
$session[<span class="hljs-string">'captcha'</span>] = <span class="hljs-keyword">new</span> \ArrayObject;
...
$session[<span class="hljs-string">'captcha'</span>][<span class="hljs-string">'number'</span>] = <span class="hljs-number">5</span>;
$session[<span class="hljs-string">'captcha'</span>][<span class="hljs-string">'lifetime'</span>] = <span class="hljs-number">3600</span>;

<span class="hljs-comment">// записывайте данные с ключами, имеющими одинаковый префикс</span>
$session[<span class="hljs-string">'captcha.number'</span>] = <span class="hljs-number">5</span>;
$session[<span class="hljs-string">'captcha.lifetime'</span>] = <span class="hljs-number">3600</span>;
</code></pre>
<p>Для улучшения производительности и читаемости кода рекомендуется использовать последний прием. Другими словами, вместо того, чтобы хранить массив как одну переменную сессии, мы сохраняем каждый элемент массива как обычную сессионную переменную с общим префиксом.</p>
<h3>Пользовательское хранилище для сессии  <span id="custom-session-storage"></span><a href="#custom-session-storage" class="hashlink">&para;</a></h3><p>По умолчанию класс <a href="./yii-web-session.html">yii\web\Session</a> сохраняет данные сессии в виде файлов на сервере. Однако Yii предоставляет ряд классов, которые реализуют различные способы хранения данных сессии:</p>
<ul>
<li><a href="./yii-web-dbsession.html">yii\web\DbSession</a>: сохраняет данные сессии в базе данных.</li>
<li><a href="./yii-web-cachesession.html">yii\web\CacheSession</a>: хранение данных сессии в предварительно сконфигурированном компоненте кэша <a href="guide-caching-data.html#cache-components">кэш</a>.</li>
<li><a href="./yii-redis-session.html">yii\redis\Session</a>: хранение данных сессии в <a href="http://redis.io/">redis</a>.</li>
<li><a href="./yii-mongodb-session.html">yii\mongodb\Session</a>: хранение сессии в <a href="http://www.mongodb.org/">MongoDB</a>.</li>
</ul>
<p>Все эти классы поддерживают одинаковый набор методов API. В результате вы можете переключаться между различными хранилищами сессий без модификации кода приложения.</p>
<blockquote class="note"><p><strong>Примечание: </strong>Если вы хотите получить данные из переменной <code>$_SESSION</code> при использовании пользовательского хранилища, вы должны быть уверены, что сессия уже стартовала <a href="./yii-web-session.html#open()-detail">yii\web\Session::open()</a>, в связи с тем, что обработчики хранения пользовательских сессий регистрируются в этом методе.</p>
</blockquote>
<p>Чтобы узнать, как настроить и использовать эти компоненты, обратитесь к документации по API. Ниже приведен пример конфигурации <a href="./yii-web-dbsession.html">yii\web\DbSession</a> для использования базы данных для хранения сессии:</p>
<pre><code class="hljs php language-php"><span class="hljs-keyword">return</span> [
    <span class="hljs-string">'components'</span> =&gt; [
        <span class="hljs-string">'session'</span> =&gt; [
            <span class="hljs-string">'class'</span> =&gt; <span class="hljs-string">'yii\web\DbSession'</span>,
            <span class="hljs-comment">// 'db' =&gt; 'mydb',  // ID компонента для взаимодействия с БД. По умолчанию 'db'.</span>
            <span class="hljs-comment">// 'sessionTable' =&gt; 'my_session', // название таблицы для хранения данных сессии. По умолчанию 'session'.</span>
        ],
    ],
];
</code></pre>
<p>Также необходимо создать таблицу для хранения данных сессии:</p>
<pre><code class="hljs sql language-sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">session</span>
(
    <span class="hljs-keyword">id</span> <span class="hljs-built_in">CHAR</span>(<span class="hljs-number">40</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> PRIMARY <span class="hljs-keyword">KEY</span>,
    <span class="hljs-keyword">expire</span> <span class="hljs-built_in">INTEGER</span>,
    <span class="hljs-keyword">data</span> <span class="hljs-built_in">BLOB</span>
)
</code></pre>
<p>где 'BLOB' соответствует типу данных предпочитаемой вами DBMS. Ниже приведены примеры соответствия типов BLOB в наиболее популярных DBMS:</p>
<ul>
<li>MySQL: LONGBLOB</li>
<li>PostgreSQL: BYTEA</li>
<li>MSSQL: BLOB</li>
</ul>
<blockquote class="note"><p><strong>Примечание: </strong>В зависимости от настроек параметра <code>session.hash_function</code> в вашем php.ini, может понадобиться изменить длину поля <code>id</code>. Например, если <code>session.hash_function=sha256</code>, нужно  установить длину поля в 64 вместо 40.</p>
</blockquote>
<h3>Flash-сообщения  <span id="flash-data"></span><a href="#flash-data" class="hashlink">&para;</a></h3><p>Flash-сообщения - это особый тип данных в сессии, которые устанавливаются один раз во время запроса и доступны только на протяжении следующего запроса, затем они автоматически удаляются. Такой способ хранения информации в сессии наиболее часто используется для реализации сообщений, которые будут отображены конечному пользователю один раз, например подтверждение об успешной отправке формы.</p>
<p>Установить и получить flash-сообщения можно через компонент приложения <code>session</code>. Например:</p>
<pre><code class="hljs php language-php">$session = Yii::$app-&gt;session;

<span class="hljs-comment">// Запрос #1</span>
<span class="hljs-comment">// установка flash-сообщения с названием "postDeleted"</span>
$session-&gt;setFlash(<span class="hljs-string">'postDeleted'</span>, <span class="hljs-string">'Вы успешно удалили пост.'</span>);

<span class="hljs-comment">// Запрос #2</span>
<span class="hljs-comment">// отображение flash-сообщения "postDeleted"</span>
<span class="hljs-keyword">echo</span> $session-&gt;getFlash(<span class="hljs-string">'postDeleted'</span>);

<span class="hljs-comment">// Запрос #3</span>
<span class="hljs-comment">// переменная $result будет иметь значение false, так как flash-сообщение было автоматически удалено</span>
$result = $session-&gt;hasFlash(<span class="hljs-string">'postDeleted'</span>);
</code></pre>
<p>Так как flash-сообщения хранятся в сессии как обычные данные, в них можно записывать произвольную информацию, и она будет доступна лишь в следующем запросе.</p>
<p>При вызове <a href="./yii-web-session.html#setFlash()-detail">yii\web\Session::setFlash()</a>, происходит перезаписывание flash-сообщений c таким же названием.
Для того, чтобы добавить новые данные к уже существующему flash-сообщению, необходимо вызвать <a href="./yii-web-session.html#addFlash()-detail">yii\web\Session::addFlash()</a>.
Например:</p>
<pre><code class="hljs php language-php">$session = Yii::$app-&gt;session;

<span class="hljs-comment">// Запрос #1</span>
<span class="hljs-comment">// добавить новое flash-сообщение с названием "alerts"</span>
$session-&gt;addFlash(<span class="hljs-string">'alerts'</span>, <span class="hljs-string">'Вы успешно удалили пост.'</span>);
$session-&gt;addFlash(<span class="hljs-string">'alerts'</span>, <span class="hljs-string">'Вы успешно добавили нового друга.'</span>);
$session-&gt;addFlash(<span class="hljs-string">'alerts'</span>, <span class="hljs-string">'Благодарим.'</span>);

<span class="hljs-comment">// Запрос #2</span>
<span class="hljs-comment">// Переменная $alerts теперь содержит массив flash-сообщений с названием "alerts"</span>
$alerts = $session-&gt;getFlash(<span class="hljs-string">'alerts'</span>);
</code></pre>
<blockquote class="note"><p><strong>Примечание: </strong>Старайтесь не использовать <a href="./yii-web-session.html#setFlash()-detail">yii\web\Session::setFlash()</a> совместно с <a href="./yii-web-session.html#addFlash()-detail">yii\web\Session::addFlash()</a> для flash-сообщений с одинаковым названием. Это связано с тем, что последний метод автоматически преобразует хранимые данные в массив, чтобы иметь возможность хранить и добавлять новые данные в flash-сообщения с тем же названием. В результате, при вызове <a href="./yii-web-session.html#getFlash()-detail">yii\web\Session::getFlash()</a> можно обнаружить, что возвращается массив, в то время как ожидалась строка.</p>
</blockquote>
<h2>Куки  <span id="cookies"></span><a href="#cookies" class="hashlink">&para;</a></h2><p>Yii представляет каждую куку как объект <a href="./yii-web-cookie.html">yii\web\Cookie</a>. Оба компонента приложения <a href="./yii-web-request.html">yii\web\Request</a> и <a href="./yii-web-response.html">yii\web\Response</a>
поддерживают коллекции кук через свойство <code>cookies</code>. В первом случае коллекция кук является их представлением из HTTP-запроса, во втором - представляет куки, которые будут отправлены пользователю.</p>
<h3>Чтение кук  <span id="reading-cookies"></span><a href="#reading-cookies" class="hashlink">&para;</a></h3><p>Получить куки из текущего запроса можно следующим образом:</p>
<pre><code class="hljs php language-php"><span class="hljs-comment">// получение коллекции кук (yii\web\CookieCollection) из компонента "request"</span>
$cookies = Yii::$app-&gt;request-&gt;cookies;

<span class="hljs-comment">// получение куки с названием "language. Если кука не существует, "en"  будет возвращено как значение по-умолчанию.</span>
$language = $cookies-&gt;getValue(<span class="hljs-string">'language'</span>, <span class="hljs-string">'en'</span>);

<span class="hljs-comment">// альтернативный способ получения куки "language"</span>
<span class="hljs-keyword">if</span> (($cookie = $cookies-&gt;get(<span class="hljs-string">'language'</span>)) !== <span class="hljs-keyword">null</span>) {
    $language = $cookie-&gt;value;
}

<span class="hljs-comment">// теперь переменную $cookies можно использовать как массив</span>
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>($cookies[<span class="hljs-string">'language'</span>])) {
    $language = $cookies[<span class="hljs-string">'language'</span>]-&gt;value;
}

<span class="hljs-comment">// проверка на существование куки "language"</span>
<span class="hljs-keyword">if</span> ($cookies-&gt;has(<span class="hljs-string">'language'</span>)) ...
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>($cookies[<span class="hljs-string">'language'</span>])) ...
</code></pre>
<h3>Отправка кук  <span id="sending-cookies"></span><a href="#sending-cookies" class="hashlink">&para;</a></h3><p>Отправить куку конечному пользователю можно следующим образом:</p>
<pre><code class="hljs php language-php"><span class="hljs-comment">// получение коллекции (yii\web\CookieCollection) из компонента "response"</span>
$cookies = Yii::$app-&gt;response-&gt;cookies;

<span class="hljs-comment">// добавление новой куки в HTTP-ответ</span>
$cookies-&gt;add(<span class="hljs-keyword">new</span> \yii\web\Cookie([
    <span class="hljs-string">'name'</span> =&gt; <span class="hljs-string">'language'</span>,
    <span class="hljs-string">'value'</span> =&gt; <span class="hljs-string">'zh-CN'</span>,
]));

<span class="hljs-comment">// удаление куки...</span>
$cookies-&gt;remove(<span class="hljs-string">'language'</span>);
<span class="hljs-comment">// ...что эквивалентно следующему:</span>
<span class="hljs-keyword">unset</span>($cookies[<span class="hljs-string">'language'</span>]);
</code></pre>
<p>Кроме свойств <a href="./yii-web-cookie.html#$name-detail">name</a> и <a href="./yii-web-cookie.html#$value-detail">value</a>, класс <a href="./yii-web-cookie.html">yii\web\Cookie</a> также предоставляет ряд свойств для получения информации о куках: <a href="./yii-web-cookie.html#$domain-detail">domain</a>, <a href="./yii-web-cookie.html#$expire-detail">expire</a>. Эти свойства можно сконфигурировать и затем добавить куку в коллекцию для HTTP-ответа.</p>
<blockquote class="note"><p><strong>Примечание: </strong>Для большей безопасности значение свойства <a href="./yii-web-cookie.html#$httpOnly-detail">yii\web\Cookie::$httpOnly</a> по умолчанию установлено в <code>true</code>. Это уменьшает риски доступа к защищенной куке на клиентской стороне (если браузер поддерживает такую возможность). Вы можете обратиться к <a href="https://www.owasp.org/index.php/HttpOnly">httpOnly wiki</a> для дополнительной информации.</p>
</blockquote>
<h3>Валидация кук  <span id="cookie-validation"></span><a href="#cookie-validation" class="hashlink">&para;</a></h3><p>Во время записи и чтения кук через компоненты <code>request</code> и <code>response</code>, как будет показано в двух последующих подразделах, фреймворк предоставляет автоматическую валидацию, которая обеспечивает защиту кук от модификации на стороне клиента. Это достигается за счет подписи каждой куки секретным ключом, позволяющим приложению распознать куку, которая была модифицирована на клиентской стороне. В таком случае кука НЕ БУДЕТ доступна через свойство <a href="./yii-web-request.html#$cookies-detail">cookie collection</a> компонента <code>request</code>.</p>
<blockquote class="note"><p><strong>Примечание: </strong>Валидация кук защищает только от их модификации. Если валидация не была пройдена, получить доступ к кукам все еще можно через глобальную переменную <code>$_COOKIE</code>. Это связано с тем, что дополнительные пакеты и библиотеки могут манипулировать куками без вызова валидации, которую обеспечивает Yii.</p>
</blockquote>
<p>По-умолчанию валидация кук включена. Её можно отключить, установив свойство <a href="./yii-web-request.html#$enableCookieValidation-detail">yii\web\Request::$enableCookieValidation</a>
в <code>false</code>, однако мы настоятельно не рекомендуем это делать.</p>
<blockquote class="note"><p><strong>Примечание: </strong>Куки, которые напрямую читаются/пишутся через <code>$_COOKIE</code> и <code>setcookie()</code> НЕ БУДУТ валидироваться.</p>
</blockquote>
<p>При использовании валидации кук необходимо указать значение свойства <a href="./yii-web-request.html#$cookieValidationKey-detail">yii\web\Request::$cookieValidationKey</a>, которое будет использовано для генерации вышеупомянутого секретного ключа. Это можно сделать, настроив компонент <code>request</code> в конфигурации приложения:</p>
<pre><code class="hljs php language-php"><span class="hljs-keyword">return</span> [
    <span class="hljs-string">'components'</span> =&gt; [
        <span class="hljs-string">'request'</span> =&gt; [
            <span class="hljs-string">'cookieValidationKey'</span> =&gt; <span class="hljs-string">'fill in a secret key here'</span>,
        ],
    ],
];
</code></pre>
<blockquote class="note"><p><strong>Примечание: </strong>Свойство <a href="./yii-web-request.html#$cookieValidationKey-detail">cookieValidationKey</a> является секретным значением и должно быть известно только людям, которым вы доверяете. Не помещайте эту информацию под систему контроля версий.</p>
</blockquote>
        <div class="toplink"><a href="#" class="h1" title="go to top"><span class="glyphicon glyphicon-arrow-up"></a></div>
    </div>
</div>


</div>

<footer class="footer">
        <p class="pull-right"><small>Page generated on Wed, 09 Dec 2020 00:16:03 +0000</small></p>
    Powered by <a href="http://www.yiiframework.com/" rel="external">Yii Framework</a></footer>

<script>jQuery(function ($) {
    var shiftWindow = function () { scrollBy(0, -50) };
    if (location.hash) setTimeout(shiftWindow, 1);
    window.addEventListener("hashchange", shiftWindow);
var element = document.createElement("script");
element.src = "./jssearch.index.js";
document.body.appendChild(element);

var searchBox = $('#searchbox');

// search when typing in search field
searchBox.on("keyup", function(event) {
    var query = $(this).val();

    if (query == '' || event.which == 27) {
        $('#search-resultbox').hide();
        return;
    } else if (event.which == 13) {
        var selectedLink = $('#search-resultbox a.selected');
        if (selectedLink.length != 0) {
            document.location = selectedLink.attr('href');
            return;
        }
    } else if (event.which == 38 || event.which == 40) {
        $('#search-resultbox').show();

        var selected = $('#search-resultbox a.selected');
        if (selected.length == 0) {
            $('#search-results').find('a').first().addClass('selected');
        } else {
            var next;
            if (event.which == 40) {
                next = selected.parent().next().find('a').first();
            } else {
                next = selected.parent().prev().find('a').first();
            }
            if (next.length != 0) {
                var resultbox = $('#search-results');
                var position = next.position();

//              TODO scrolling is buggy and jumps around
//                resultbox.scrollTop(Math.floor(position.top));
//                console.log(position.top);

                selected.removeClass('selected');
                next.addClass('selected');
            }
        }

        return;
    }
    $('#search-resultbox').show();
    $('#search-results').html('<li><span class="no-results">No results</span></li>');

    var result = jssearch.search(query);

    if (result.length > 0) {
        var i = 0;
        var resHtml = '';

        for (var key in result) {
            if (i++ > 20) {
                break;
            }
            resHtml = resHtml +
            '<li><a href="' + result[key].file.u.substr(3) +'"><span class="title">' + result[key].file.t + '</span>' +
            '<span class="description">' + result[key].file.d + '</span></a></li>';
        }
        $('#search-results').html(resHtml);
    }
});

// hide the search results on ESC
$(document).on("keyup", function(event) { if (event.which == 27) { $('#search-resultbox').hide(); } });
// hide search results on click to document
$(document).bind('click', function (e) { $('#search-resultbox').hide(); });
// except the following:
searchBox.bind('click', function(e) { e.stopPropagation(); });
$('#search-resultbox').bind('click', function(e) { e.stopPropagation(); });

});</script></body>
</html>
