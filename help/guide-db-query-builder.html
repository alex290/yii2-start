<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="language" content="en" />
        
<link href="./assets/1728b664/css/bootstrap.css" rel="stylesheet">
<link href="./assets/9c5d0894/solarized_light.css" rel="stylesheet">
<link href="./assets/f2ce5bcd/style.css" rel="stylesheet">
<script src="./assets/bbf84a7a/jquery.js"></script>
<script src="./assets/1728b664/js/bootstrap.js"></script>
<script src="./assets/fd63b446/jssearch.js"></script>    <title>Построитель запросов - Работа с базами данных - The Definitive Guide to Yii 2.0</title>
</head>
<body>

<div class="wrap">
    <nav id="w1726" class="navbar-inverse navbar-fixed-top navbar"><div class="navbar-header"><button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#w1726-collapse"><span class="sr-only">Toggle navigation</span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
<span class="icon-bar"></span></button><a class="navbar-brand" href="./index.html">The Definitive Guide to Yii 2.0</a></div><div id="w1726-collapse" class="collapse navbar-collapse"><ul id="w1727" class="navbar-nav nav"><li><a href="./index.html">Class reference</a></li>
<li class="dropdown"><a class="dropdown-toggle" href="#" data-toggle="dropdown">Extensions <span class="caret"></span></a><ul id="w1728" class="dropdown-menu"><li><a href="./ext-apidoc-index.html" tabindex="-1">apidoc</a></li>
<li><a href="./ext-authclient-index.html" tabindex="-1">authclient</a></li>
<li><a href="./ext-bootstrap-index.html" tabindex="-1">bootstrap</a></li>
<li><a href="./ext-debug-index.html" tabindex="-1">debug</a></li>
<li><a href="./ext-elasticsearch-index.html" tabindex="-1">elasticsearch</a></li>
<li><a href="./ext-faker-index.html" tabindex="-1">faker</a></li>
<li><a href="./ext-gii-index.html" tabindex="-1">gii</a></li>
<li><a href="./ext-httpclient-index.html" tabindex="-1">httpclient</a></li>
<li><a href="./ext-imagine-index.html" tabindex="-1">imagine</a></li>
<li><a href="./ext-jui-index.html" tabindex="-1">jui</a></li>
<li><a href="./ext-mongodb-index.html" tabindex="-1">mongodb</a></li>
<li><a href="./ext-redis-index.html" tabindex="-1">redis</a></li>
<li><a href="./ext-shell-index.html" tabindex="-1">shell</a></li>
<li><a href="./ext-smarty-index.html" tabindex="-1">smarty</a></li>
<li><a href="./ext-sphinx-index.html" tabindex="-1">sphinx</a></li>
<li><a href="./ext-swiftmailer-index.html" tabindex="-1">swiftmailer</a></li>
<li><a href="./ext-twig-index.html" tabindex="-1">twig</a></li></ul></li>
<li><a href="./guide-README.html">Guide</a></li></ul><div class="navbar-form navbar-left" role="search">
  <div class="form-group">
    <input id="searchbox" type="text" class="form-control" placeholder="Search">
  </div>
</div>
</div></nav>
    <div id="search-resultbox" style="display: none;" class="modal-content">
        <ul id="search-results">
        </ul>
    </div>

    
<div class="row">
    <div class="col-md-2">
                <div id="navigation" class="list-group"><a class="list-group-item" href="#navigation-1710" data-toggle="collapse" data-parent="#navigation">Введение <b class="caret"></b></a><div id="navigation-1710" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-intro-yii.html">О Yii</a>
<a class="list-group-item" href="./guide-intro-upgrade-from-v1.html">Обновление с версии 1.1</a></div>
<a class="list-group-item" href="#navigation-1711" data-toggle="collapse" data-parent="#navigation">Первое знакомство <b class="caret"></b></a><div id="navigation-1711" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-start-installation.html">Установка Yii</a>
<a class="list-group-item" href="./guide-start-workflow.html">Запуск приложения</a>
<a class="list-group-item" href="./guide-start-hello.html">Говорим «привет»</a>
<a class="list-group-item" href="./guide-start-forms.html">Работа с формами</a>
<a class="list-group-item" href="./guide-start-databases.html">Работа с базами данных</a>
<a class="list-group-item" href="./guide-start-gii.html">Генерация кода при помощи Gii</a>
<a class="list-group-item" href="./guide-start-looking-ahead.html">Что дальше?</a></div>
<a class="list-group-item" href="#navigation-1712" data-toggle="collapse" data-parent="#navigation">Структура приложения <b class="caret"></b></a><div id="navigation-1712" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-structure-overview.html">Обзор</a>
<a class="list-group-item" href="./guide-structure-entry-scripts.html">Входные скрипты</a>
<a class="list-group-item" href="./guide-structure-applications.html">Приложения</a>
<a class="list-group-item" href="./guide-structure-application-components.html">Компоненты приложения</a>
<a class="list-group-item" href="./guide-structure-controllers.html">Контроллеры</a>
<a class="list-group-item" href="./guide-structure-models.html">Модели</a>
<a class="list-group-item" href="./guide-structure-views.html">Представления</a>
<a class="list-group-item" href="./guide-structure-modules.html">Модули</a>
<a class="list-group-item" href="./guide-structure-filters.html">Фильтры</a>
<a class="list-group-item" href="./guide-structure-widgets.html">Виджеты</a>
<a class="list-group-item" href="./guide-structure-assets.html">Ресурсы</a>
<a class="list-group-item" href="./guide-structure-extensions.html">Расширения</a></div>
<a class="list-group-item" href="#navigation-1713" data-toggle="collapse" data-parent="#navigation">Обработка запросов <b class="caret"></b></a><div id="navigation-1713" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-runtime-overview.html">Обзор</a>
<a class="list-group-item" href="./guide-runtime-bootstrapping.html">Bootstrapping</a>
<a class="list-group-item" href="./guide-runtime-routing.html">Разбор и генерация URL</a>
<a class="list-group-item" href="./guide-runtime-requests.html">Запросы</a>
<a class="list-group-item" href="./guide-runtime-responses.html">Ответы</a>
<a class="list-group-item" href="./guide-runtime-sessions-cookies.html">Сессии и куки</a>
<a class="list-group-item" href="./guide-runtime-handling-errors.html">Обработка ошибок</a>
<a class="list-group-item" href="./guide-runtime-logging.html">Логирование</a></div>
<a class="list-group-item" href="#navigation-1714" data-toggle="collapse" data-parent="#navigation">Основные понятия <b class="caret"></b></a><div id="navigation-1714" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-concept-components.html">Компоненты</a>
<a class="list-group-item" href="./guide-concept-properties.html">Свойства</a>
<a class="list-group-item" href="./guide-concept-events.html">События</a>
<a class="list-group-item" href="./guide-concept-behaviors.html">Поведения</a>
<a class="list-group-item" href="./guide-concept-configurations.html">Конфигурации</a>
<a class="list-group-item" href="./guide-concept-aliases.html">Псевдонимы</a>
<a class="list-group-item" href="./guide-concept-autoloading.html">Автозагрузка классов</a>
<a class="list-group-item" href="./guide-concept-service-locator.html">Service Locator</a>
<a class="list-group-item" href="./guide-concept-di-container.html">Dependency Injection Container</a></div>
<a class="list-group-item active" href="#navigation-1715" data-toggle="collapse" data-parent="#navigation">Работа с базами данных <b class="caret"></b></a><div id="navigation-1715" class="submenu panel-collapse collapse in"><a class="list-group-item" href="./guide-db-dao.html">Объекты доступа к данным (DAO)</a>
<a class="list-group-item active" href="./guide-db-query-builder.html">Построитель запросов</a>
<a class="list-group-item" href="./guide-db-active-record.html">Active Record</a>
<a class="list-group-item" href="./guide-db-migrations.html">Миграции</a>
<a class="list-group-item" href="https://github.com/yiisoft/yii2-sphinx/blob/master/docs/guide-ru/README.md">Sphinx</a>
<a class="list-group-item" href="https://github.com/yiisoft/yii2-redis/blob/master/docs/guide-ru/README.md">Redis</a>
<a class="list-group-item" href="https://github.com/yiisoft/yii2-mongodb/blob/master/docs/guide-ru/README.md">MongoDB</a>
<a class="list-group-item" href="https://github.com/yiisoft/yii2-elasticsearch/blob/master/docs/guide-ru/README.md">ElasticSearch</a></div>
<a class="list-group-item" href="#navigation-1716" data-toggle="collapse" data-parent="#navigation">Получение данных от пользователя <b class="caret"></b></a><div id="navigation-1716" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-input-forms.html">Создание форм</a>
<a class="list-group-item" href="./guide-input-validation.html">Валидация</a>
<a class="list-group-item" href="./guide-input-file-upload.html">Загрузка файлов</a>
<a class="list-group-item" href="./guide-input-tabular-input.html">Табличный ввод</a>
<a class="list-group-item" href="./guide-input-multiple-models.html">Работа с несколькими моделями</a>
<a class="list-group-item" href="./guide-input-form-javascript.html">Расширение ActiveForm на стороне клиента</a></div>
<a class="list-group-item" href="#navigation-1717" data-toggle="collapse" data-parent="#navigation">Отображение данных <b class="caret"></b></a><div id="navigation-1717" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-output-formatting.html">Форматирование данных</a>
<a class="list-group-item" href="./guide-output-pagination.html">Постраничная разбивка</a>
<a class="list-group-item" href="./guide-output-sorting.html">Сортировка</a>
<a class="list-group-item" href="./guide-output-data-providers.html">Провайдеры данных</a>
<a class="list-group-item" href="./guide-output-data-widgets.html">Виджеты для данных</a>
<a class="list-group-item" href="./guide-output-client-scripts.html">Работа с клиентскими скриптами</a>
<a class="list-group-item" href="./guide-output-theming.html">Темизация</a></div>
<a class="list-group-item" href="#navigation-1718" data-toggle="collapse" data-parent="#navigation">Безопасность <b class="caret"></b></a><div id="navigation-1718" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-security-overview.html">Обзор</a>
<a class="list-group-item" href="./guide-security-authentication.html">Аутентификация</a>
<a class="list-group-item" href="./guide-security-authorization.html">Авторизация</a>
<a class="list-group-item" href="./guide-security-passwords.html">Работа с паролями</a>
<a class="list-group-item" href="./guide-security-cryptography.html">Криптография</a>
<a class="list-group-item" href="https://github.com/yiisoft/yii2-authclient/blob/master/docs/guide-ru/README.md">Клиенты авторизации</a>
<a class="list-group-item" href="./guide-security-best-practices.html">Лучшие практики</a></div>
<a class="list-group-item" href="#navigation-1719" data-toggle="collapse" data-parent="#navigation">Кеширование <b class="caret"></b></a><div id="navigation-1719" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-caching-overview.html">Обзор</a>
<a class="list-group-item" href="./guide-caching-data.html">Кэширование данных</a>
<a class="list-group-item" href="./guide-caching-fragment.html">Кэширование фрагментов</a>
<a class="list-group-item" href="./guide-caching-page.html">Кэширование страниц</a>
<a class="list-group-item" href="./guide-caching-http.html">HTTP кэширование</a></div>
<a class="list-group-item" href="#navigation-1720" data-toggle="collapse" data-parent="#navigation">Веб-сервисы REST <b class="caret"></b></a><div id="navigation-1720" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-rest-quick-start.html">Быстрый старт</a>
<a class="list-group-item" href="./guide-rest-resources.html">Ресурсы</a>
<a class="list-group-item" href="./guide-rest-controllers.html">Контроллеры</a>
<a class="list-group-item" href="./guide-rest-routing.html">Роутинг</a>
<a class="list-group-item" href="./guide-rest-response-formatting.html">Форматирование ответа</a>
<a class="list-group-item" href="./guide-rest-authentication.html">Аутентификация</a>
<a class="list-group-item" href="./guide-rest-rate-limiting.html">Ограничение частоты запросов</a>
<a class="list-group-item" href="./guide-rest-versioning.html">Версионирование</a>
<a class="list-group-item" href="./guide-rest-error-handling.html">Обработка ошибок</a></div>
<a class="list-group-item" href="#navigation-1721" data-toggle="collapse" data-parent="#navigation">Инструменты разработчика <b class="caret"></b></a><div id="navigation-1721" class="submenu panel-collapse collapse"><a class="list-group-item" href="https://github.com/yiisoft/yii2-debug/blob/master/docs/guide/README.md">Отладочная панель и отладчик</a>
<a class="list-group-item" href="https://github.com/yiisoft/yii2-gii/blob/master/docs/guide/README.md">Генерация кода с Gii</a>
<a class="list-group-item" href="https://github.com/yiisoft/yii2-apidoc">Генератор документации API</a></div>
<a class="list-group-item" href="#navigation-1722" data-toggle="collapse" data-parent="#navigation">Тестирование <b class="caret"></b></a><div id="navigation-1722" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-test-overview.html">Обзор</a>
<a class="list-group-item" href="./guide-test-environment-setup.html">Настройка тестового окружения</a>
<a class="list-group-item" href="./guide-test-unit.html">Модульные тесты</a>
<a class="list-group-item" href="./guide-test-functional.html">Функциональные тесты</a>
<a class="list-group-item" href="./guide-test-acceptance.html">Приёмочные тесты</a>
<a class="list-group-item" href="./guide-test-fixtures.html">Фикстуры</a></div>
<a class="list-group-item" href="#navigation-1723" data-toggle="collapse" data-parent="#navigation">Специальные темы <b class="caret"></b></a><div id="navigation-1723" class="submenu panel-collapse collapse"><a class="list-group-item" href="https://github.com/yiisoft/yii2-app-advanced/blob/master/docs/guide/README.md">Шаблон приложения advanced</a>
<a class="list-group-item" href="./guide-tutorial-start-from-scratch.html">Создание приложения с нуля</a>
<a class="list-group-item" href="./guide-tutorial-console.html">Консольные команды</a>
<a class="list-group-item" href="./guide-tutorial-core-validators.html">Встроенные валидаторы</a>
<a class="list-group-item" href="./guide-tutorial-i18n.html">Интернационализация</a>
<a class="list-group-item" href="./guide-tutorial-mailing.html">Отправка почты</a>
<a class="list-group-item" href="./guide-tutorial-performance-tuning.html">Оптимизация производительности</a>
<a class="list-group-item" href="./guide-tutorial-shared-hosting.html">Окружение виртуального хостинга</a>
<a class="list-group-item" href="./guide-tutorial-template-engines.html">Шаблонизаторы</a>
<a class="list-group-item" href="./guide-tutorial-yii-integration.html">Работа со сторонним кодом</a>
<a class="list-group-item" href="./guide-tutorial-yii-as-micro-framework.html">Использование Yii в качестве микро-framework&#039;а</a></div>
<a class="list-group-item" href="#navigation-1724" data-toggle="collapse" data-parent="#navigation">Виджеты <b class="caret"></b></a><div id="navigation-1724" class="submenu panel-collapse collapse"><a class="list-group-item" href="http://www.yiiframework.com/doc-2.0/yii-grid-gridview.html">GridView</a>
<a class="list-group-item" href="http://www.yiiframework.com/doc-2.0/yii-widgets-listview.html">ListView</a>
<a class="list-group-item" href="http://www.yiiframework.com/doc-2.0/yii-widgets-detailview.html">DetailView</a>
<a class="list-group-item" href="http://www.yiiframework.com/doc-2.0/guide-input-forms.html#activerecord-based-forms-activeform">ActiveForm</a>
<a class="list-group-item" href="http://www.yiiframework.com/doc-2.0/yii-widgets-pjax.html">Pjax</a>
<a class="list-group-item" href="http://www.yiiframework.com/doc-2.0/yii-widgets-menu.html">Menu</a>
<a class="list-group-item" href="http://www.yiiframework.com/doc-2.0/yii-widgets-linkpager.html">LinkPager</a>
<a class="list-group-item" href="http://www.yiiframework.com/doc-2.0/yii-widgets-linksorter.html">LinkSorter</a>
<a class="list-group-item" href="https://github.com/yiisoft/yii2-bootstrap/blob/master/docs/guide-ru/README.md">Виджеты Bootstrap</a>
<a class="list-group-item" href="https://github.com/yiisoft/yii2-jui/blob/master/docs/guide-ru/README.md">Виджеты Jquery UI</a></div>
<a class="list-group-item" href="#navigation-1725" data-toggle="collapse" data-parent="#navigation">Хелперы <b class="caret"></b></a><div id="navigation-1725" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-helper-overview.html">Обзор</a>
<a class="list-group-item" href="./guide-helper-array.html">ArrayHelper</a>
<a class="list-group-item" href="./guide-helper-html.html">Html</a>
<a class="list-group-item" href="./guide-helper-url.html">Url хелпер</a></div></div>    </div>
    <div class="col-md-9 guide-content" role="main">
        <h1>Построитель запросов <span id="postroitel-zaprosov"></span><a href="#postroitel-zaprosov" class="hashlink">&para;</a></h1>
<div class="toc"><ol><li><a href="#building-queries">Построение запросов</a></li>
<li><a href="#query-methods">Методы выборки</a></li></ol></div>
<p>Построенный поверх <a href="guide-db-dao.html">DAO</a>, построитель запросов позволяет конструировать SQL выражения в программируемом и
независимом от СУБД виде. В сравнении с написанием чистого SQL выражения, использование построителя помогает 
вам писать более читаемый связанный с SQL код и генерировать более безопасные SQL выражения.</p>
<p>Использование построителя запросов, как правило, включает два этапа:</p>
<ol>
<li>Создание объекта <a href="./yii-db-query.html">yii\db\Query</a> представляющего различные части (такие как <code>SELECT</code>, <code>FROM</code>) SQL выражения SELECT.</li>
<li>Выполнить запрос методом <a href="./yii-db-query.html">yii\db\Query</a> (таким как <code>all()</code>) для извлечения данных из базы данных.</li>
</ol>
<p>Следующий код показывает обычное использование построителя запросов:</p>
<pre><code class="hljs php language-php">$rows = (<span class="hljs-keyword">new</span> \yii\db\Query())
    -&gt;select([<span class="hljs-string">'id'</span>, <span class="hljs-string">'email'</span>])
    -&gt;from(<span class="hljs-string">'user'</span>)
    -&gt;where([<span class="hljs-string">'last_name'</span> =&gt; <span class="hljs-string">'Smith'</span>])
    -&gt;limit(<span class="hljs-number">10</span>)
    -&gt;all();
</code></pre>
<p>Приведённый выше код создаёт и выполняет следующее SQL выражение, где параметр <code>:last_name</code> привязывается к строке <code>'Smith'</code>.</p>
<pre><code class="hljs sql language-sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-string">`id`</span>, <span class="hljs-string">`email`</span> 
<span class="hljs-keyword">FROM</span> <span class="hljs-string">`user`</span>
<span class="hljs-keyword">WHERE</span> <span class="hljs-string">`last_name`</span> = :last_name
<span class="hljs-keyword">LIMIT</span> <span class="hljs-number">10</span>
</code></pre>
<blockquote class="info"><p><strong>Информация: </strong>В основном вы будете работать с <a href="./yii-db-query.html">yii\db\Query</a> вместо <a href="./yii-db-querybuilder.html">yii\db\QueryBuilder</a>. Последний вызывается
  неявно при вызове одного из методов запроса. <a href="./yii-db-querybuilder.html">yii\db\QueryBuilder</a> это класс, отвечающий за генерацию зависимого
  от СУБД SQL выражения (такие как экранирование имён таблиц/столбцов) из независимых от СУБД объектов <a href="./yii-db-query.html">yii\db\Query</a>. </p>
</blockquote>
<h2>Построение запросов  <span id="building-queries"></span><a href="#building-queries" class="hashlink">&para;</a></h2><p>Создав объект <a href="./yii-db-query.html">yii\db\Query</a>, вы можете вызвать различные методы для создания различных частей SQL выражения.
Имена методов напоминают ключевые слова SQL, используемые в соответствующих частях SQL запроса. Например,
чтобы указать <code>FROM</code> часть запроса, вам нужно вызвать метод <a href="./yii-db-query.html#from()-detail">from()</a>. Все методы построителя
запросов возвращают свой объект, который позволяет объединять несколько вызовов в цепочку.</p>
<p>Далее будет описание каждого метода построителя запросов.</p>
<h3><a href="./yii-db-query.html#select()-detail">select()</a>  <span id="select"></span><a href="#select" class="hashlink">&para;</a></h3><p>Метод <a href="./yii-db-query.html#select()-detail">select()</a> определяет фрагмент <code>SELECT</code> SQL запроса. Вы можете указать столбцы, которые
должны быть выбраны, они должны быть указаны в виде массива или строки. Имена столбцов автоматически экранируются
при создании SQL-запроса при его генерации из объекта <a href="./yii-db-query.html">yii\db\Query</a>.</p>
<pre><code class="hljs php language-php">$query-&gt;select([<span class="hljs-string">'id'</span>, <span class="hljs-string">'email'</span>]);

<span class="hljs-comment">// эквивалентно:</span>

$query-&gt;select(<span class="hljs-string">'id, email'</span>);
</code></pre>
<p>Имена столбцов могут быть выбраны вместе с префиксами таблиц и/или алиасами столбцов, также как при записи обычного SQL выражения.
Например,</p>
<pre><code class="hljs php language-php">$query-&gt;select([<span class="hljs-string">'user.id AS user_id'</span>, <span class="hljs-string">'email'</span>]);

<span class="hljs-comment">// эквивалентно:</span>

$query-&gt;select(<span class="hljs-string">'user.id AS user_id, email'</span>);
</code></pre>
<p>Если вы используете формат массива для указания столбцов, вы можете также указать ключи массива для указания алиасов столбцов.
Например, приведённый выше код может быть переписан:</p>
<pre><code class="hljs php language-php">$query-&gt;select([<span class="hljs-string">'user_id'</span> =&gt; <span class="hljs-string">'user.id'</span>, <span class="hljs-string">'email'</span>]);
</code></pre>
<p>Если вы не вызываете метод <a href="./yii-db-query.html#select()-detail">select()</a> при создании запроса, будет использована <code>*</code>, что означает
выбрать <em>все</em> столбцы.</p>
<p>Кроме имён столбцов, вы можете также использовать SQL выражения. Вы должны использовать формат массива для использования
выражений, которые содержат запятые для предотвращения некорректного автоматического экранирования. Например,</p>
<pre><code class="hljs php language-php">$query-&gt;select([<span class="hljs-string">"CONCAT(first_name, ' ', last_name) AS full_name"</span>, <span class="hljs-string">'email'</span>]); 
</code></pre>
<p>Начиная с версии 2.0.1, вы также можете использовать подзапросы. Вы должны указывать каждый подзапрос в выражении как
объект <a href="./yii-db-query.html">yii\db\Query</a>. Например,</p>
<pre><code class="hljs php language-php">$subQuery = (<span class="hljs-keyword">new</span> Query())-&gt;select(<span class="hljs-string">'COUNT(*)'</span>)-&gt;from(<span class="hljs-string">'user'</span>);

<span class="hljs-comment">// SELECT `id`, (SELECT COUNT(*) FROM `user`) AS `count` FROM `post`</span>
$query = (<span class="hljs-keyword">new</span> Query())-&gt;select([<span class="hljs-string">'id'</span>, <span class="hljs-string">'count'</span> =&gt; $subQuery])-&gt;from(<span class="hljs-string">'post'</span>);
</code></pre>
<p>Чтоб выбрать конкретные строки, вы можете вызвать метод <a href="./yii-db-query.html#distinct()-detail">distinct()</a>:</p>
<pre><code class="hljs php language-php"><span class="hljs-comment">// SELECT DISTINCT `user_id` ...</span>
$query-&gt;select(<span class="hljs-string">'user_id'</span>)-&gt;distinct();
</code></pre>
<p>Вы можете вызвать <a href="./yii-db-query.html#addSelect()-detail">addSelect()</a> для добавления полей. Например,</p>
<pre><code class="hljs php language-php">$query-&gt;select([<span class="hljs-string">'id'</span>, <span class="hljs-string">'username'</span>])
    -&gt;addSelect([<span class="hljs-string">'email'</span>]);
</code></pre>
<h3><a href="./yii-db-query.html#from()-detail">from()</a>  <span id="from"></span><a href="#from" class="hashlink">&para;</a></h3><p>Метод <a href="./yii-db-query.html#from()-detail">from()</a> указывает фрагмент <code>FROM</code> SQL запроса. Например,</p>
<pre><code class="hljs php language-php"><span class="hljs-comment">// SELECT * FROM `user`</span>
$query-&gt;from(<span class="hljs-string">'user'</span>);
</code></pre>
<p>Вы можете указать имена таблиц в виде строки или массива. Имена таблиц могут содержать префикс схемы и/или алиасы
таблиц, как при написании обычного SQL выражения. Например,</p>
<pre><code class="hljs php language-php">$query-&gt;from([<span class="hljs-string">'public.user u'</span>, <span class="hljs-string">'public.post p'</span>]);

<span class="hljs-comment">// эквивалентно:</span>

$query-&gt;from(<span class="hljs-string">'public.user u, public.post p'</span>);
</code></pre>
<p>Если вы используете формат массива, вы можете использовать ключи массива для указания алиасов:</p>
<pre><code class="hljs php language-php">$query-&gt;from([<span class="hljs-string">'u'</span> =&gt; <span class="hljs-string">'public.user'</span>, <span class="hljs-string">'p'</span> =&gt; <span class="hljs-string">'public.post'</span>]);
</code></pre>
<p>Кроме имён таблиц, вы можете так же, как и в select, указывать подзапросы в виде объекта <a href="./yii-db-query.html">yii\db\Query</a>.</p>
<pre><code class="hljs php language-php">$subQuery = (<span class="hljs-keyword">new</span> Query())-&gt;select(<span class="hljs-string">'id'</span>)-&gt;from(<span class="hljs-string">'user'</span>)-&gt;where(<span class="hljs-string">'status=1'</span>);

<span class="hljs-comment">// SELECT * FROM (SELECT `id` FROM `user` WHERE status=1) u </span>
$query-&gt;from([<span class="hljs-string">'u'</span> =&gt; $subQuery]);
</code></pre>
<h4>Префиксы <span id="prefiksy"></span><a href="#prefiksy" class="hashlink">&para;</a></h4><p>Также может применяться <a href="./yii-db-connection.html#$tablePrefix-detail">tablePrefix</a> по умолчанию. Подробное описание смотрите
в подразделе <a href="guide-db-dao.html#quoting-table-and-column-names">«Экранирование имён таблиц и столбцов» раздела «Объекты доступа к данным (DAO)»</a>.</p>
<h3><a href="./yii-db-query.html#where()-detail">where()</a>  <span id="where"></span><a href="#where" class="hashlink">&para;</a></h3><p>Метод <a href="./yii-db-query.html#where()-detail">where()</a> определяет фрагмент <code>WHERE</code> SQL выражения. Вы можете использовать один из
трёх форматов:</p>
<ul>
<li>строковый формат, Например, <code>'status=1'</code></li>
<li>формат массива, Например, <code>['status' =&gt; 1, 'type' =&gt; 2]</code></li>
<li>формат операторов, Например, <code>['like', 'name', 'test']</code></li>
</ul>
<h4>Строковый формат  <span id="string-format"></span><a href="#string-format" class="hashlink">&para;</a></h4><p>Строковый формат - это лучший выбор для простых условий. Он работает так, будто вы просто пишете SQL запрос. Например,</p>
<pre><code class="hljs php language-php">$query-&gt;where(<span class="hljs-string">'status=1'</span>);

<span class="hljs-comment">// или используя привязку параметров</span>
$query-&gt;where(<span class="hljs-string">'status=:status'</span>, [<span class="hljs-string">':status'</span> =&gt; $status]);
</code></pre>
<p>Не встраивайте переменные непосредственно в условие, особенно если значение переменной получено от пользователя,
потому что это делает ваше приложение подверженным атакам через SQL инъекции.</p>
<pre><code class="hljs php language-php"><span class="hljs-comment">// Опасность! Не делайте так если вы не уверены, что $status это действительно число.</span>
$query-&gt;where(<span class="hljs-string">"status=$status"</span>);
</code></pre>
<p>При использовании привязки параметров, вы можете вызывать <a href="./yii-db-query.html#params()-detail">params()</a> или
<a href="./yii-db-query.html#addParams()-detail">addParams()</a> для раздельного указания параметров.</p>
<pre><code class="hljs php language-php">$query-&gt;where(<span class="hljs-string">'status=:status'</span>)
    -&gt;addParams([<span class="hljs-string">':status'</span> =&gt; $status]);
</code></pre>
<h4>Формат массива  <span id="hash-format"></span><a href="#hash-format" class="hashlink">&para;</a></h4><p>Формат массива лучше всего использовать для указания нескольких объединяемых через <code>AND</code> условий, каждое из которых
является простым равенством. Он описывается в виде массива, ключами которого являются имена столбцов, а значения
соответствуют значениям столбцов.</p>
<pre><code class="hljs php language-php"><span class="hljs-comment">// ...WHERE (`status` = 10) AND (`type` IS NULL) AND (`id` IN (4, 8, 15))</span>
$query-&gt;where([
    <span class="hljs-string">'status'</span> =&gt; <span class="hljs-number">10</span>,
    <span class="hljs-string">'type'</span> =&gt; <span class="hljs-keyword">null</span>,
    <span class="hljs-string">'id'</span> =&gt; [<span class="hljs-number">4</span>, <span class="hljs-number">8</span>, <span class="hljs-number">15</span>],
]);
</code></pre>
<p>Как вы можете видеть, построитель запросов достаточно умен, чтобы правильно обрабатывать значения <code>null</code> или массивов.</p>
<p>Вы также можете использовать подзапросы:</p>
<pre><code class="hljs php language-php">$userQuery = (<span class="hljs-keyword">new</span> Query())-&gt;select(<span class="hljs-string">'id'</span>)-&gt;from(<span class="hljs-string">'user'</span>);

<span class="hljs-comment">// ...WHERE `id` IN (SELECT `id` FROM `user`)</span>
$query-&gt;where([<span class="hljs-string">'id'</span> =&gt; $userQuery]);
</code></pre>
<p>Используя формат массива, Yii автоматически привязывает значения массива как параметры, потому в отличие от <a href="#string-format">строкового формата</a>,
привязывать параметры вручную не требуется. Обратите внимание, что Yii никогда НЕ экранирует имена столбцов (ключи массива),
потому если вы используете как ключ массива переменную, полученную от пользователя без дополнительной проверки, ваше приложение
становится подверженным атаке через SQL инъекцию. Чтобы избежать этого, используйте для имён столбцов только проверененные данные,
предпочитая фильтрацию по «белому списку». Если вам нужно использовать имя столбца, полученное от пользователя,
вам может быть полезным раздел <a href="guide-output-data-widgets.html#filtering-data">Фильтрация данных</a>. Ниже приведён пример уязвимого кода:</p>
<pre><code class="hljs php language-php"><span class="hljs-comment">// Уязвимый код:</span>
$column = $request-&gt;get(<span class="hljs-string">'column'</span>);
$value = $request-&gt;get(<span class="hljs-string">'value'</span>);
$query-&gt;where([$column =&gt; $value]);
<span class="hljs-comment">// $value будет безопасно привязано как параметр, но $column – нет!</span>
</code></pre>
<h4>Формат операторов  <span id="operator-format"></span><a href="#operator-format" class="hashlink">&para;</a></h4><p>Формат оператора позволяет задавать произвольные условия в программном стиле. Он имеет следующий вид:</p>
<pre><code class="hljs php language-php">[operator, operand1, operand2, ...]
</code></pre>
<p>Операнды могут быть заданы в виде строкового формата, формата массива или формата операторов рекурсивно, в то время
как оператор может быть одним из следующих:</p>
<ul>
<li><p><code>and</code>: операнды должны быть объединены с помощью оператора <code>AND</code>. Например,
<code>['and', 'id=1', 'id=2']</code> сгенерирует <code>id=1 AND id=2</code>. Если операнд массив,
он будет сконвертирован в строку по правилам описанным ниже. Например,
<code>['and', 'type=1', ['or', 'id=1', 'id=2']]</code> сгенерирует <code>type=1 AND (id=1 OR id=2)</code>.
Этот метод не производит никакого экранирования.</p>
</li>
<li><p><code>or</code>: похож на оператор <code>and</code> за исключением того, что будет использоваться оператор <code>OR</code>.</p>
</li>
<li><p><code>between</code>: первый операнд должен быть именем столбца, а второй и третий оператор должны быть начальным и конечным
 значением диапазона. Например, <code>['between', 'id', 1, 10]</code> сгенерирует <code>id BETWEEN 1 AND 10</code>.</p>
</li>
<li><p><code>not between</code>: похож на <code>between</code> за исключением того, что <code>BETWEEN</code> заменяется на <code>NOT BETWEEN</code>
в сгенерированном условии.</p>
</li>
<li><p><code>in</code>: первый операнд должен быть столбцом или выражением БД. Второй операнд может быть либо массивом, либо объектом <code>Query</code>.
Будет сгенерировано условие <code>IN</code>. Если второй операнд массив, он будет представлять набор значений, которым может быть
равен столбец или выражение БД; Если второй операнд объект <code>Query</code>, будет сформирован подзапрос, который будет использован
как диапазон для столбца или выражения БД. Например, <code>['in', 'id', [1, 2, 3]]</code> сформирует <code>id IN (1, 2, 3)</code>.
Метод будет правильно экранировать имя столбца и значения диапазона. Оператор <code>in</code> также поддерживает составные столбцы.
В этом случае, первый операнд должен быть массивом названий столбцов, в то время как операнд 2 должен быть массивом
массивов или объектом <code>Query</code> представляющим диапазоны для столбцов.</p>
</li>
<li><p><code>not in</code>: похож на оператор <code>in</code>, кроме того что <code>IN</code> будет заменён на <code>NOT IN</code> в сформированном условии.</p>
</li>
<li><p><code>like</code>: первый операнд должен быть столбцом или выражением БД, а второй операнд будет строкой или массивом представляющим
значения, на которые должны быть похожи столбцы или выражения БД. Например, <code>['like', 'name', 'tester']</code>
сформирует <code>name LIKE '%tester%'</code>. 
Когда диапазон значений задан в виде массива, несколько <code>LIKE</code> утверждений будут сформированы и соединены с помощью <code>AND</code>.
Например, <code>['like', 'name', ['test', 'sample']]</code> сформирует <code>name LIKE '%test%' AND name LIKE '%sample%'</code>.
Вы также можете передать третий необязательный операнд, для указания способа экранирования специальных символов в значениях.
Операнд должен быть представлен массивом соответствия специальных символов их экранированным аналогам. Если этот
операнд не задан, то будет использовано соответствие по умолчанию. Вы можете также использовать значение <code>false</code>
или пустой массив, чтоб указать что значения уже экранированы. Обратите внимание, что при использовании массива соответствия
экранирования (или если третий операнд не передан), значения будут автоматически заключены в символы процентов.</p>
<blockquote class="note"><p><strong>Примечание: </strong>При использовании PostgreSQL вы можете использовать также <a href="http://www.postgresql.org/docs/8.3/static/functions-matching.html#FUNCTIONS-LIKE"><code>ilike</code></a>
вместо <code>like</code> для регистронезависимого поиска.</p>
</blockquote>
</li>
<li><p><code>or like</code>: похож на оператор <code>like</code>, только утверждения <code>LIKE</code> будут объединяться с помощью оператора <code>OR</code>, если
второй операнд будет представлен массивом.</p>
</li>
<li><p><code>not like</code>: похож на оператор <code>like</code>, только <code>LIKE</code> будет заменён на <code>NOT LIKE</code> в сгенерированном условии.</p>
</li>
<li><p><code>or not like</code>: похож на оператор <code>not like</code>, только утверждения <code>NOT LIKE</code> будут объединены с помощью <code>OR</code>.</p>
</li>
<li><p><code>exists</code>: требует один операнд, который должен быть экземпляром <a href="./yii-db-query.html">yii\db\Query</a> представляющим подзапрос. Будет
сгенерировано выражение <code>EXISTS (sub-query)</code>.</p>
</li>
<li><p><code>not exists</code>: похож на оператор <code>exists</code> и сформирует выражение <code>NOT EXISTS (sub-query)</code>.</p>
</li>
<li><p><code>&gt;</code>, <code>&lt;=</code>, или другие валидные операторы БД, которые требуют двух операндов: первый операнд должен быть именем
столбца, второй операнд это значение. Например, <code>['&gt;', 'age', 10]</code> сформирует <code>age&gt;10</code>.</p>
</li>
</ul>
<p>Используя формат операторов, Yii автоматически привязывает значения для сравнения как параметры, потому в отличие от <a href="#string-format">строкового формата</a>,
привязывать параметры вручную не требуется. Обратите внимание, что Yii никогда НЕ экранирует имена столбцов,
потому если вы используете как имя столбца переменную, полученную от пользователя без дополнительной проверки, ваше приложение
становится подверженным атаке через SQL инъекцию. Чтобы избежать этого, используйте для имён столбцов только проверененные данные,
предпочитая фильтрацию по «белому списку». Если вам нужно использовать имя столбца, полученное от пользователя,
вам может быть полезным раздел <a href="guide-output-data-widgets.html#filtering-data">Фильтрация данных</a>. Ниже приведён пример уязвимого кода:</p>
<pre><code class="hljs php language-php"><span class="hljs-comment">// Уязвимый код:</span>
$column = $request-&gt;get(<span class="hljs-string">'column'</span>);
$value = $request-&gt;get(<span class="hljs-string">'value'</span>);
$query-&gt;where([<span class="hljs-string">'='</span>, $column, $value]);
<span class="hljs-comment">// $value будет безопасно привязано как параметр, но $column – нет!</span>
</code></pre>
<h4>Добавление условий  <span id="appending-conditions"></span><a href="#appending-conditions" class="hashlink">&para;</a></h4><p>Вы можете использовать <a href="./yii-db-query.html#andWhere()-detail">andWhere()</a> или <a href="./yii-db-query.html#orWhere()-detail">orWhere()</a> для добавления
дополнительных условий. Вы можете использовать эти вызовы несколько раз для добавления нескольких условий.
Например,</p>
<pre><code class="hljs php language-php">$status = <span class="hljs-number">10</span>;
$search = <span class="hljs-string">'yii'</span>;

$query-&gt;where([<span class="hljs-string">'status'</span> =&gt; $status]);

<span class="hljs-keyword">if</span> (!<span class="hljs-keyword">empty</span>($search)) {
    $query-&gt;andWhere([<span class="hljs-string">'like'</span>, <span class="hljs-string">'title'</span>, $search]);
}
</code></pre>
<p>Если <code>$search</code> не пустое, то будет сформировано следующее условие WHERE:</p>
<pre><code class="hljs sql language-sql">WHERE (`status` = 10) AND (`title` LIKE '%yii%')
</code></pre>
<h4>Условия для фильтров  <span id="filter-conditions"></span><a href="#filter-conditions" class="hashlink">&para;</a></h4><p>Когда условие <code>WHERE</code> формируется на основе пользовательского ввода, обычно, хочется проигнорировать не заданные значения.
Например, в форме поиска, которая позволяет осуществлять поиск по имени пользователя или email, вы хотели бы игнорировать
username/email условие, если пользователь ничего не ввёл в поле ввода. Вы можете достичь этого используя метод
<a href="./yii-db-querytrait.html#filterWhere()-detail">filterWhere()</a>.</p>
<pre><code class="hljs php language-php"><span class="hljs-comment">// $username и $email вводит пользователь</span>
$query-&gt;filterWhere([
    <span class="hljs-string">'username'</span> =&gt; $username,
    <span class="hljs-string">'email'</span> =&gt; $email,
]);
</code></pre>
<p>Единственное отличие между <a href="./yii-db-querytrait.html#filterWhere()-detail">filterWhere()</a> и <a href="./yii-db-query.html#where()-detail">where()</a> 
заключается в игнорировании пустых значений, переданных в условие в <a href="#hash-format">форме массива</a>. Таким образом
если <code>$email</code> будет пустым, а <code>$username</code> нет, то приведённый выше код сформирует условие <code>WHERE username=:username</code>.</p>
<blockquote class="info"><p><strong>Информация: </strong>значение признаётся пустым, если это <code>null</code>, пустой массив, пустая строка или строка состоящая из одних пробельных символов.</p>
</blockquote>
<p>Также вместо <a href="./yii-db-query.html#andWhere()-detail">andWhere()</a> и <a href="./yii-db-query.html#orWhere()-detail">orWhere()</a>, вы можете использовать
<a href="./yii-db-querytrait.html#andFilterWhere()-detail">andFilterWhere()</a> и <a href="./yii-db-querytrait.html#orFilterWhere()-detail">orFilterWhere()</a>
для добавления дополнительных условий фильтрации.</p>
<h3><a href="./yii-db-querytrait.html#orderBy()-detail">orderBy()</a>  <span id="order-by"></span><a href="#order-by" class="hashlink">&para;</a></h3><table class="table table-bordered table-striped">
<thead>
<tr><th>Метод <a href="./yii-db-querytrait.html#orderBy()-detail">orderBy()</a> определяет фрагмент <code>ORDER BY</code> SQL выражения. Например,</th></tr>
</thead>
<tbody>
<tr><td><code>`</code>php</td></tr>
<tr><td>// ... ORDER BY <code>id</code> ASC, <code>name</code> DESC</td></tr>
<tr><td>$query-&gt;orderBy([</td></tr>
<tr><td>'id' =&gt; SORT_ASC,</td></tr>
<tr><td>'name' =&gt; SORT_DESC,</td></tr>
<tr><td>]);</td></tr>
<tr><td><code>`</code></td></tr>
</tbody>
</table>
<p>В данном коде, ключи массива - это имена столбцов, а значения массива - это соответствующее направление сортировки.
PHP константа <code>SORT_ASC</code> определяет сортировку по возрастанию и <code>SORT_DESC</code> сортировка по умолчанию.</p>
<p>Если <code>ORDER BY</code> содержит только простые имена столбцов, вы можете определить их с помощью столбцов, также
как и при написании обычного SQL. Например,</p>
<pre><code class="hljs php language-php">$query-&gt;orderBy(<span class="hljs-string">'id ASC, name DESC'</span>);
</code></pre>
<blockquote class="note"><p><strong>Примечание: </strong>Вы должны использовать массив для указания <code>ORDER BY</code> содержащих выражения БД.</p>
</blockquote>
<p>Вы можете вызывать <a href="./yii-db-querytrait.html#addOrderBy()-detail">addOrderBy()</a> для добавления столбцов во фрагмент <code>ORDER BY</code>.</p>
<pre><code class="hljs php language-php">$query-&gt;orderBy(<span class="hljs-string">'id ASC'</span>)
    -&gt;addOrderBy(<span class="hljs-string">'name DESC'</span>);
</code></pre>
<h3><a href="./yii-db-query.html#groupBy()-detail">groupBy()</a>  <span id="group-by"></span><a href="#group-by" class="hashlink">&para;</a></h3><p>Метод <a href="./yii-db-query.html#groupBy()-detail">groupBy()</a> определяет фрагмент <code>GROUP BY</code> SQL запроса.</p>
<pre><code class="hljs php language-php"><span class="hljs-comment">// ... GROUP BY `id`, `status`</span>
$query-&gt;groupBy([<span class="hljs-string">'id'</span>, <span class="hljs-string">'status'</span>]);
</code></pre>
<p>Если фрагмент <code>GROUP BY</code> содержит только простые имена столбцов, вы можете указать их используя строку, также как в
обычном SQL выражении.</p>
<pre><code class="hljs php language-php">$query-&gt;groupBy(<span class="hljs-string">'id, status'</span>);
</code></pre>
<blockquote class="note"><p><strong>Примечание: </strong>Вы должны использовать массив для указания <code>GROUP BY</code> содержащих выражения БД.</p>
</blockquote>
<p>Вы можете вызывать <a href="./yii-db-query.html#addGroupBy()-detail">addGroupBy()</a> для добавления имён столбцов во фрагмент <code>GROUP BY</code>.
Например,</p>
<pre><code class="hljs php language-php">$query-&gt;groupBy([<span class="hljs-string">'id'</span>, <span class="hljs-string">'status'</span>])
    -&gt;addGroupBy(<span class="hljs-string">'age'</span>);
</code></pre>
<h3><a href="./yii-db-query.html#having()-detail">having()</a>  <span id="having"></span><a href="#having" class="hashlink">&para;</a></h3><p>Метод <a href="./yii-db-query.html#having()-detail">having()</a> определяет фрагмент <code>HAVING</code> SQL запроса. Он принимает условия, которое
может быть определено тем же способом, что и для <a href="#where">where()</a>.</p>
<pre><code class="hljs php language-php"><span class="hljs-comment">// ... HAVING `status` = 1</span>
$query-&gt;having([<span class="hljs-string">'status'</span> =&gt; <span class="hljs-number">1</span>]);
</code></pre>
<p>Пожалуйста, обратитесь к документации для <a href="#where">where()</a> для более подробной информации об определении условий.</p>
<p>Вы можете вызывать <a href="./yii-db-query.html#andHaving()-detail">andHaving()</a> или <a href="./yii-db-query.html#orHaving()-detail">orHaving()</a> для добавления
дополнительных условий во фрагмент <code>HAVING</code>.</p>
<pre><code class="hljs php language-php"><span class="hljs-comment">// ... HAVING (`status` = 1) AND (`age` &gt; 30)</span>
$query-&gt;having([<span class="hljs-string">'status'</span> =&gt; <span class="hljs-number">1</span>])
    -&gt;andHaving([<span class="hljs-string">'&gt;'</span>, <span class="hljs-string">'age'</span>, <span class="hljs-number">30</span>]);
</code></pre>
<h3><a href="./yii-db-querytrait.html#limit()-detail">limit()</a> и <a href="./yii-db-querytrait.html#offset()-detail">offset()</a>  <span id="limit-offset"></span><a href="#limit-offset" class="hashlink">&para;</a></h3><p>Методы <a href="./yii-db-querytrait.html#limit()-detail">limit()</a> и <a href="./yii-db-querytrait.html#offset()-detail">offset()</a> определяют фрагменты <code>LIMIT</code>
и <code>OFFSET</code> SQL запроса.</p>
<pre><code class="hljs php language-php"><span class="hljs-comment">// ... LIMIT 10 OFFSET 20</span>
$query-&gt;limit(<span class="hljs-number">10</span>)-&gt;offset(<span class="hljs-number">20</span>);
</code></pre>
<p>Если вы определяете неправильный limit или offset (например отрицательное значение), они будут проигнорированы.</p>
<blockquote class="info"><p><strong>Информация: </strong>Для СУБД, которые не поддерживают <code>LIMIT</code> и <code>OFFSET</code> (такие как MSSQL), построитель запросов будет
  генерировать SQL выражения, которые эмулирует поведение <code>LIMIT</code>/<code>OFFSET</code>.</p>
</blockquote>
<h3><a href="./yii-db-query.html#join()-detail">join()</a>  <span id="join"></span><a href="#join" class="hashlink">&para;</a></h3><table class="table table-bordered table-striped">
<thead>
<tr><th>Метод <a href="./yii-db-query.html#join()-detail">join()</a> определяет фрагмент <code>JOIN</code> SQL запроса.</th></tr>
</thead>
<tbody>
<tr><td><code>`</code>php</td></tr>
<tr><td>// ... LEFT JOIN <code>post</code> ON <code>post</code>.<code>user_id</code> = <code>user</code>.<code>id</code></td></tr>
<tr><td>$query-&gt;join('LEFT JOIN', 'post', 'post.user_id = user.id');</td></tr>
<tr><td><code>`</code></td></tr>
</tbody>
</table>
<table class="table table-bordered table-striped">
<thead>
<tr><th>Метод <a href="./yii-db-query.html#join()-detail">join()</a> принимает четыре параметра:</th></tr>
</thead>
<tbody>
<tr><td>- <code>$type</code>: тип объединения, например, <code>'INNER JOIN'</code>, <code>'LEFT JOIN'</code>.</td></tr>
<tr><td>- <code>$table</code>: имя таблицы, которая должна быть присоединена.</td></tr>
<tr><td>- <code>$on</code>: необязательное условие объединения, то есть фрагмент <code>ON</code>. Пожалуйста, обратитесь к документации для</td></tr>
<tr><td><a href="#where">where()</a> для более подробной информации об определении условий. Отметим, что синтаксис массивов <strong>не работает</strong></td></tr>
<tr><td>для задания условий для столбцов, то есть <code>['user.id' =&gt; 'comment.userId']</code> будет означать условие, где ID пользователя</td></tr>
<tr><td>должен быть равен строке <code>'comment.userId'</code>. Вместо этого стоит указывать условие в виде строки <code>'user.id = comment.userId'</code>.</td></tr>
<tr><td>- <code>$params</code>: необязательные параметры присоединяемые к условию объединения.</td></tr>
</tbody>
</table>
<p>Вы можете использовать следующие сокращающие методы для указания <code>INNER JOIN</code>, <code>LEFT JOIN</code> и <code>RIGHT JOIN</code>, в указанном порядке.</p>
<ul>
<li><a href="./yii-db-query.html#innerJoin()-detail">innerJoin()</a></li>
<li><a href="./yii-db-query.html#leftJoin()-detail">leftJoin()</a></li>
<li><a href="./yii-db-query.html#rightJoin()-detail">rightJoin()</a></li>
</ul>
<p>Например,</p>
<pre><code class="hljs php language-php">$query-&gt;leftJoin(<span class="hljs-string">'post'</span>, <span class="hljs-string">'post.user_id = user.id'</span>);
</code></pre>
<p>Для соединения с несколькими таблицами, вызовите вышеуказанные методы несколько раз.</p>
<p>Кроме соединения с таблицами, вы можете также присоединять подзапросы. Чтобы это сделать, укажите объединяемый подзапрос
как объект <a href="./yii-db-query.html">yii\db\Query</a>.</p>
<pre><code class="hljs php language-php">$subQuery = (<span class="hljs-keyword">new</span> \yii\db\Query())-&gt;from(<span class="hljs-string">'post'</span>);
$query-&gt;leftJoin([<span class="hljs-string">'u'</span> =&gt; $subQuery], <span class="hljs-string">'u.id = author_id'</span>);
</code></pre>
<p>В этом случае вы должны передать подзапросы в массиве и использовать ключи для определения алиасов.</p>
<h3><a href="./yii-db-query.html#union()-detail">union()</a>  <span id="union"></span><a href="#union" class="hashlink">&para;</a></h3><p>Метод <a href="./yii-db-query.html#union()-detail">union()</a> определяет фрагмент <code>UNION</code> SQL запроса.</p>
<pre><code class="hljs php language-php">$query1 = (<span class="hljs-keyword">new</span> \yii\db\Query())
    -&gt;select(<span class="hljs-string">"id, category_id AS type, name"</span>)
    -&gt;from(<span class="hljs-string">'post'</span>)
    -&gt;limit(<span class="hljs-number">10</span>);

$query2 = (<span class="hljs-keyword">new</span> \yii\db\Query())
    -&gt;select(<span class="hljs-string">'id, type, name'</span>)
    -&gt;from(<span class="hljs-string">'user'</span>)
    -&gt;limit(<span class="hljs-number">10</span>);

$query1-&gt;union($query2);
</code></pre>
<p>Вы можете вызвать <a href="./yii-db-query.html#union()-detail">union()</a> несколько раз для присоединения фрагментов <code>UNION</code>. </p>
<h2>Методы выборки  <span id="query-methods"></span><a href="#query-methods" class="hashlink">&para;</a></h2><p><a href="./yii-db-query.html">yii\db\Query</a> предоставляет целый набор методов для разных вариантов выборки:</p>
<ul>
<li><a href="./yii-db-query.html#all()-detail">all()</a>: возвращает массив строк, каждая из которых это ассоциативный массив пар ключ-значение.</li>
<li><a href="./yii-db-query.html#one()-detail">one()</a>: возвращает первую строку запроса.</li>
<li><a href="./yii-db-query.html#column()-detail">column()</a>: возвращает первый столбец результата.</li>
<li><a href="./yii-db-query.html#scalar()-detail">scalar()</a>: возвращает скалярное значение первого столбца первой строки результата.</li>
<li><a href="./yii-db-query.html#exists()-detail">exists()</a>: возвращает значение указывающее, что выборка содержит результат.</li>
<li><a href="./yii-db-query.html#count()-detail">count()</a>: возвращает результат <code>COUNT</code> запроса.</li>
<li>Другие методы агрегирования запросов, включая <a href="./yii-db-query.html#sum()-detail">sum($q)</a>, <a href="./yii-db-query.html#average()-detail">average($q)</a>,
<a href="./yii-db-query.html#max()-detail">max($q)</a>, <a href="./yii-db-query.html#min()-detail">min($q)</a>. Параметр <code>$q</code> обязателен для этих методов и могут
содержать либо имя столбца, либо выражение БД.</li>
</ul>
<p>Например,</p>
<pre><code class="hljs php language-php"><span class="hljs-comment">// SELECT `id`, `email` FROM `user`</span>
$rows = (<span class="hljs-keyword">new</span> \yii\db\Query())
    -&gt;select([<span class="hljs-string">'id'</span>, <span class="hljs-string">'email'</span>])
    -&gt;from(<span class="hljs-string">'user'</span>)
    -&gt;all();
    
<span class="hljs-comment">// SELECT * FROM `user` WHERE `username` LIKE `%test%`</span>
$row = (<span class="hljs-keyword">new</span> \yii\db\Query())
    -&gt;from(<span class="hljs-string">'user'</span>)
    -&gt;where([<span class="hljs-string">'like'</span>, <span class="hljs-string">'username'</span>, <span class="hljs-string">'test'</span>])
    -&gt;one();
</code></pre>
<blockquote class="note"><p><strong>Примечание: </strong>метод <a href="./yii-db-query.html#one()-detail">one()</a> вернёт только первую строку результата запроса. Он НЕ добавляет
  <code>LIMIT 1</code> в генерируемый SQL. Это хорошо и предпочтительно если вы знаете, что запрос вернёт только одну или несколько
  строк данных (например, при запросе по первичному ключу). Однако если запрос потенциально может вернут много
  строк данных, вы должны вызвать <code>limit(1)</code> для повышения производительности, Например, 
  <code>(new \yii\db\Query())-&gt;from('user')-&gt;limit(1)-&gt;one()</code>.</p>
</blockquote>
<p>Все методы выборки могут получать необязательный параметр <code>$db</code>, представляющий <a href="./yii-db-connection.html">соединение с БД</a>,
которое должно использоваться, чтобы выполнить запрос к БД. Если вы упускаете этот параметр, будет использоваться
<a href="guide-structure-application-components.html">компонент приложения</a> <code>$db</code>. Ниже приведён ещё один пример использования метода
<a href="./yii-db-query.html#count()-detail">count()</a>:</p>
<pre><code class="hljs php language-php"><span class="hljs-comment">// executes SQL: SELECT COUNT(*) FROM `user` WHERE `last_name`=:last_name</span>
$count = (<span class="hljs-keyword">new</span> \yii\db\Query())
    -&gt;from(<span class="hljs-string">'user'</span>)
    -&gt;where([<span class="hljs-string">'last_name'</span> =&gt; <span class="hljs-string">'Smith'</span>])
    -&gt;count();
</code></pre>
<p>При вызове методов выборки <a href="./yii-db-query.html">yii\db\Query</a>, внутри на самом деле проводится следующая работа:</p>
<ul>
<li>Вызывается <a href="./yii-db-querybuilder.html">yii\db\QueryBuilder</a> для генерации SQL запроса на основе текущего <a href="./yii-db-query.html">yii\db\Query</a>;</li>
<li>Создаёт объект <a href="./yii-db-command.html">yii\db\Command</a> со сгенерированным SQL запросом;</li>
<li>Вызывается выбирающий метод (например <a href="./yii-db-command.html#queryAll()-detail">queryAll()</a>) из <a href="./yii-db-command.html">yii\db\Command</a> для выполнения SQL запроса и извлечения данных.</li>
</ul>
<p>Иногда вы можете захотеть увидеть или использовать SQL запрос построенный из объекта <a href="./yii-db-query.html">yii\db\Query</a>. Этой цели можно
добиться с помощью следующего кода: </p>
<pre><code class="hljs php language-php">$command = (<span class="hljs-keyword">new</span> \yii\db\Query())
    -&gt;select([<span class="hljs-string">'id'</span>, <span class="hljs-string">'email'</span>])
    -&gt;from(<span class="hljs-string">'user'</span>)
    -&gt;where([<span class="hljs-string">'last_name'</span> =&gt; <span class="hljs-string">'Smith'</span>])
    -&gt;limit(<span class="hljs-number">10</span>)
    -&gt;createCommand();
    
<span class="hljs-comment">// показать SQL запрос</span>
<span class="hljs-keyword">echo</span> $command-&gt;sql;
<span class="hljs-comment">// показать привязываемые параметры</span>
print_r($command-&gt;params);

<span class="hljs-comment">// возвращает все строки запроса</span>
$rows = $command-&gt;queryAll();
</code></pre>
<h3>Индексация результатов запроса  <span id="indexing-query-results"></span><a href="#indexing-query-results" class="hashlink">&para;</a></h3><p>При вызове <a href="./yii-db-query.html#all()-detail">all()</a> возвращается массив строк индексированный последовательными целыми числами.
Иногда вам может потребоваться индексировать его по-другому, например, сделать индекс по указанному столбцу или
значением выражения. Вы можете реализовать такое поведение через вызов <a href="./yii-db-querytrait.html#indexBy()-detail">indexBy()</a> перед
вызовом <a href="./yii-db-query.html#all()-detail">all()</a>.</p>
<pre><code class="hljs php language-php"><span class="hljs-comment">// возвращает [100 =&gt; ['id' =&gt; 100, 'username' =&gt; '...', ...], 101 =&gt; [...], 103 =&gt; [...], ...]</span>
$query = (<span class="hljs-keyword">new</span> \yii\db\Query())
    -&gt;from(<span class="hljs-string">'user'</span>)
    -&gt;limit(<span class="hljs-number">10</span>)
    -&gt;indexBy(<span class="hljs-string">'id'</span>)
    -&gt;all();
</code></pre>
<p>Для индексации по значению выражения, передайте анонимную функцию в метод <a href="./yii-db-querytrait.html#indexBy()-detail">indexBy()</a>:</p>
<pre><code class="hljs php language-php">$query = (<span class="hljs-keyword">new</span> \yii\db\Query())
    -&gt;from(<span class="hljs-string">'user'</span>)
    -&gt;indexBy(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">($row)</span> </span>{
        <span class="hljs-keyword">return</span> $row[<span class="hljs-string">'id'</span>] . $row[<span class="hljs-string">'username'</span>];
    })-&gt;all();
</code></pre>
<p>Анонимная функция должна принимать параметр <code>$row</code>, который содержит текущую строку запроса и должна вернуть скалярное
значение, которое будет использоваться как значение индекса для текущей строки.</p>
<h3>Пакетная выборка  <span id="batch-query"></span><a href="#batch-query" class="hashlink">&para;</a></h3><p>При работе с большими объемами данных, методы наподобие <a href="./yii-db-query.html#all()-detail">yii\db\Query::all()</a> не подходят, потому что они требуют
загрузки всех данных в память. Чтобы сохранить требования к памяти минимальными, Yii предоставляет поддержку
так называемых пакетных выборок. Пакетная выборка делает возможным курсоры данных и выборку данных пакетами.</p>
<p>Пакетная выборка может использоваться следующим образом:</p>
<pre><code class="hljs php language-php"><span class="hljs-keyword">use</span> <span class="hljs-title">yii</span>\<span class="hljs-title">db</span>\<span class="hljs-title">Query</span>;

$query = (<span class="hljs-keyword">new</span> Query())
    -&gt;from(<span class="hljs-string">'user'</span>)
    -&gt;orderBy(<span class="hljs-string">'id'</span>);

<span class="hljs-keyword">foreach</span> ($query-&gt;batch() <span class="hljs-keyword">as</span> $users) {
    <span class="hljs-comment">// $users это массив из 100 или менее строк из таблицы пользователей</span>
}

<span class="hljs-comment">// или если вы хотите перебрать все строки по одной</span>
<span class="hljs-keyword">foreach</span> ($query-&gt;each() <span class="hljs-keyword">as</span> $user) {
    <span class="hljs-comment">// $user представляет одну строку из выборки</span>
}
</code></pre>
<p>Метод <a href="./yii-db-query.html#batch()-detail">yii\db\Query::batch()</a> и <a href="./yii-db-query.html#each()-detail">yii\db\Query::each()</a> возвращает объект <a href="./yii-db-batchqueryresult.html">yii\db\BatchQueryResult</a>, который
реализует интерфейс <code>Iterator</code> и может использоваться в конструкции <code>foreach</code>. Во время первой итерации будет выполнен
SQL запрос к базе данных. Данные будут выбираться пакетами в следующих итерациях. По умолчанию, размер пакета имеет
размер 100, то есть при каждой выборке будет выбираться по 100 строк. Вы можете изменить размер пакета, передав
первый параметр в метод <code>batch()</code> или <code>each()</code>.</p>
<p>По сравнению с <a href="./yii-db-query.html#all()-detail">yii\db\Query::all()</a>, пакетная выборка загружает только по 100 строк данных за раз в память.
Если вы обрабатываете данные и затем сразу выбрасываете их, пакетная выборка может помочь уменьшить использование памяти.</p>
<p>Если указать индексный столбец через <a href="./yii-db-querytrait.html#indexBy()-detail">yii\db\Query::indexBy()</a>, в пакетной выборке индекс будет сохраняться.
Например,</p>
<pre><code class="hljs php language-php">$query = (<span class="hljs-keyword">new</span> \yii\db\Query())
    -&gt;from(<span class="hljs-string">'user'</span>)
    -&gt;indexBy(<span class="hljs-string">'username'</span>);

<span class="hljs-keyword">foreach</span> ($query-&gt;batch() <span class="hljs-keyword">as</span> $users) {
    <span class="hljs-comment">// $users индексируется по столбцу "username"</span>
}

<span class="hljs-keyword">foreach</span> ($query-&gt;each() <span class="hljs-keyword">as</span> $username =&gt; $user) {
    <span class="hljs-comment">// ...</span>
}
</code></pre>
        <div class="toplink"><a href="#" class="h1" title="go to top"><span class="glyphicon glyphicon-arrow-up"></a></div>
    </div>
</div>


</div>

<footer class="footer">
        <p class="pull-right"><small>Page generated on Wed, 09 Dec 2020 00:16:08 +0000</small></p>
    Powered by <a href="http://www.yiiframework.com/" rel="external">Yii Framework</a></footer>

<script>jQuery(function ($) {
    var shiftWindow = function () { scrollBy(0, -50) };
    if (location.hash) setTimeout(shiftWindow, 1);
    window.addEventListener("hashchange", shiftWindow);
var element = document.createElement("script");
element.src = "./jssearch.index.js";
document.body.appendChild(element);

var searchBox = $('#searchbox');

// search when typing in search field
searchBox.on("keyup", function(event) {
    var query = $(this).val();

    if (query == '' || event.which == 27) {
        $('#search-resultbox').hide();
        return;
    } else if (event.which == 13) {
        var selectedLink = $('#search-resultbox a.selected');
        if (selectedLink.length != 0) {
            document.location = selectedLink.attr('href');
            return;
        }
    } else if (event.which == 38 || event.which == 40) {
        $('#search-resultbox').show();

        var selected = $('#search-resultbox a.selected');
        if (selected.length == 0) {
            $('#search-results').find('a').first().addClass('selected');
        } else {
            var next;
            if (event.which == 40) {
                next = selected.parent().next().find('a').first();
            } else {
                next = selected.parent().prev().find('a').first();
            }
            if (next.length != 0) {
                var resultbox = $('#search-results');
                var position = next.position();

//              TODO scrolling is buggy and jumps around
//                resultbox.scrollTop(Math.floor(position.top));
//                console.log(position.top);

                selected.removeClass('selected');
                next.addClass('selected');
            }
        }

        return;
    }
    $('#search-resultbox').show();
    $('#search-results').html('<li><span class="no-results">No results</span></li>');

    var result = jssearch.search(query);

    if (result.length > 0) {
        var i = 0;
        var resHtml = '';

        for (var key in result) {
            if (i++ > 20) {
                break;
            }
            resHtml = resHtml +
            '<li><a href="' + result[key].file.u.substr(3) +'"><span class="title">' + result[key].file.t + '</span>' +
            '<span class="description">' + result[key].file.d + '</span></a></li>';
        }
        $('#search-results').html(resHtml);
    }
});

// hide the search results on ESC
$(document).on("keyup", function(event) { if (event.which == 27) { $('#search-resultbox').hide(); } });
// hide search results on click to document
$(document).bind('click', function (e) { $('#search-resultbox').hide(); });
// except the following:
searchBox.bind('click', function(e) { e.stopPropagation(); });
$('#search-resultbox').bind('click', function(e) { e.stopPropagation(); });

});</script></body>
</html>
