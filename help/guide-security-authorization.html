<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="language" content="en" />
        
<link href="./assets/1728b664/css/bootstrap.css" rel="stylesheet">
<link href="./assets/9c5d0894/solarized_light.css" rel="stylesheet">
<link href="./assets/f2ce5bcd/style.css" rel="stylesheet">
<script src="./assets/bbf84a7a/jquery.js"></script>
<script src="./assets/1728b664/js/bootstrap.js"></script>
<script src="./assets/fd63b446/jssearch.js"></script>    <title>Авторизация - Безопасность - The Definitive Guide to Yii 2.0</title>
</head>
<body>

<div class="wrap">
    <nav id="w1004" class="navbar-inverse navbar-fixed-top navbar"><div class="navbar-header"><button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#w1004-collapse"><span class="sr-only">Toggle navigation</span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
<span class="icon-bar"></span></button><a class="navbar-brand" href="./index.html">The Definitive Guide to Yii 2.0</a></div><div id="w1004-collapse" class="collapse navbar-collapse"><ul id="w1005" class="navbar-nav nav"><li><a href="./index.html">Class reference</a></li>
<li class="dropdown"><a class="dropdown-toggle" href="#" data-toggle="dropdown">Extensions <span class="caret"></span></a><ul id="w1006" class="dropdown-menu"><li><a href="./ext-apidoc-index.html" tabindex="-1">apidoc</a></li>
<li><a href="./ext-authclient-index.html" tabindex="-1">authclient</a></li>
<li><a href="./ext-bootstrap-index.html" tabindex="-1">bootstrap</a></li>
<li><a href="./ext-debug-index.html" tabindex="-1">debug</a></li>
<li><a href="./ext-elasticsearch-index.html" tabindex="-1">elasticsearch</a></li>
<li><a href="./ext-faker-index.html" tabindex="-1">faker</a></li>
<li><a href="./ext-gii-index.html" tabindex="-1">gii</a></li>
<li><a href="./ext-httpclient-index.html" tabindex="-1">httpclient</a></li>
<li><a href="./ext-imagine-index.html" tabindex="-1">imagine</a></li>
<li><a href="./ext-jui-index.html" tabindex="-1">jui</a></li>
<li><a href="./ext-mongodb-index.html" tabindex="-1">mongodb</a></li>
<li><a href="./ext-redis-index.html" tabindex="-1">redis</a></li>
<li><a href="./ext-shell-index.html" tabindex="-1">shell</a></li>
<li><a href="./ext-smarty-index.html" tabindex="-1">smarty</a></li>
<li><a href="./ext-sphinx-index.html" tabindex="-1">sphinx</a></li>
<li><a href="./ext-swiftmailer-index.html" tabindex="-1">swiftmailer</a></li>
<li><a href="./ext-twig-index.html" tabindex="-1">twig</a></li></ul></li>
<li><a href="./guide-README.html">Guide</a></li></ul><div class="navbar-form navbar-left" role="search">
  <div class="form-group">
    <input id="searchbox" type="text" class="form-control" placeholder="Search">
  </div>
</div>
</div></nav>
    <div id="search-resultbox" style="display: none;" class="modal-content">
        <ul id="search-results">
        </ul>
    </div>

    
<div class="row">
    <div class="col-md-2">
                <div id="navigation" class="list-group"><a class="list-group-item" href="#navigation-988" data-toggle="collapse" data-parent="#navigation">Введение <b class="caret"></b></a><div id="navigation-988" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-intro-yii.html">О Yii</a>
<a class="list-group-item" href="./guide-intro-upgrade-from-v1.html">Обновление с версии 1.1</a></div>
<a class="list-group-item" href="#navigation-989" data-toggle="collapse" data-parent="#navigation">Первое знакомство <b class="caret"></b></a><div id="navigation-989" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-start-installation.html">Установка Yii</a>
<a class="list-group-item" href="./guide-start-workflow.html">Запуск приложения</a>
<a class="list-group-item" href="./guide-start-hello.html">Говорим «привет»</a>
<a class="list-group-item" href="./guide-start-forms.html">Работа с формами</a>
<a class="list-group-item" href="./guide-start-databases.html">Работа с базами данных</a>
<a class="list-group-item" href="./guide-start-gii.html">Генерация кода при помощи Gii</a>
<a class="list-group-item" href="./guide-start-looking-ahead.html">Что дальше?</a></div>
<a class="list-group-item" href="#navigation-990" data-toggle="collapse" data-parent="#navigation">Структура приложения <b class="caret"></b></a><div id="navigation-990" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-structure-overview.html">Обзор</a>
<a class="list-group-item" href="./guide-structure-entry-scripts.html">Входные скрипты</a>
<a class="list-group-item" href="./guide-structure-applications.html">Приложения</a>
<a class="list-group-item" href="./guide-structure-application-components.html">Компоненты приложения</a>
<a class="list-group-item" href="./guide-structure-controllers.html">Контроллеры</a>
<a class="list-group-item" href="./guide-structure-models.html">Модели</a>
<a class="list-group-item" href="./guide-structure-views.html">Представления</a>
<a class="list-group-item" href="./guide-structure-modules.html">Модули</a>
<a class="list-group-item" href="./guide-structure-filters.html">Фильтры</a>
<a class="list-group-item" href="./guide-structure-widgets.html">Виджеты</a>
<a class="list-group-item" href="./guide-structure-assets.html">Ресурсы</a>
<a class="list-group-item" href="./guide-structure-extensions.html">Расширения</a></div>
<a class="list-group-item" href="#navigation-991" data-toggle="collapse" data-parent="#navigation">Обработка запросов <b class="caret"></b></a><div id="navigation-991" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-runtime-overview.html">Обзор</a>
<a class="list-group-item" href="./guide-runtime-bootstrapping.html">Bootstrapping</a>
<a class="list-group-item" href="./guide-runtime-routing.html">Разбор и генерация URL</a>
<a class="list-group-item" href="./guide-runtime-requests.html">Запросы</a>
<a class="list-group-item" href="./guide-runtime-responses.html">Ответы</a>
<a class="list-group-item" href="./guide-runtime-sessions-cookies.html">Сессии и куки</a>
<a class="list-group-item" href="./guide-runtime-handling-errors.html">Обработка ошибок</a>
<a class="list-group-item" href="./guide-runtime-logging.html">Логирование</a></div>
<a class="list-group-item" href="#navigation-992" data-toggle="collapse" data-parent="#navigation">Основные понятия <b class="caret"></b></a><div id="navigation-992" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-concept-components.html">Компоненты</a>
<a class="list-group-item" href="./guide-concept-properties.html">Свойства</a>
<a class="list-group-item" href="./guide-concept-events.html">События</a>
<a class="list-group-item" href="./guide-concept-behaviors.html">Поведения</a>
<a class="list-group-item" href="./guide-concept-configurations.html">Конфигурации</a>
<a class="list-group-item" href="./guide-concept-aliases.html">Псевдонимы</a>
<a class="list-group-item" href="./guide-concept-autoloading.html">Автозагрузка классов</a>
<a class="list-group-item" href="./guide-concept-service-locator.html">Service Locator</a>
<a class="list-group-item" href="./guide-concept-di-container.html">Dependency Injection Container</a></div>
<a class="list-group-item" href="#navigation-993" data-toggle="collapse" data-parent="#navigation">Работа с базами данных <b class="caret"></b></a><div id="navigation-993" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-db-dao.html">Объекты доступа к данным (DAO)</a>
<a class="list-group-item" href="./guide-db-query-builder.html">Построитель запросов</a>
<a class="list-group-item" href="./guide-db-active-record.html">Active Record</a>
<a class="list-group-item" href="./guide-db-migrations.html">Миграции</a>
<a class="list-group-item" href="https://github.com/yiisoft/yii2-sphinx/blob/master/docs/guide-ru/README.md">Sphinx</a>
<a class="list-group-item" href="https://github.com/yiisoft/yii2-redis/blob/master/docs/guide-ru/README.md">Redis</a>
<a class="list-group-item" href="https://github.com/yiisoft/yii2-mongodb/blob/master/docs/guide-ru/README.md">MongoDB</a>
<a class="list-group-item" href="https://github.com/yiisoft/yii2-elasticsearch/blob/master/docs/guide-ru/README.md">ElasticSearch</a></div>
<a class="list-group-item" href="#navigation-994" data-toggle="collapse" data-parent="#navigation">Получение данных от пользователя <b class="caret"></b></a><div id="navigation-994" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-input-forms.html">Создание форм</a>
<a class="list-group-item" href="./guide-input-validation.html">Валидация</a>
<a class="list-group-item" href="./guide-input-file-upload.html">Загрузка файлов</a>
<a class="list-group-item" href="./guide-input-tabular-input.html">Табличный ввод</a>
<a class="list-group-item" href="./guide-input-multiple-models.html">Работа с несколькими моделями</a>
<a class="list-group-item" href="./guide-input-form-javascript.html">Расширение ActiveForm на стороне клиента</a></div>
<a class="list-group-item" href="#navigation-995" data-toggle="collapse" data-parent="#navigation">Отображение данных <b class="caret"></b></a><div id="navigation-995" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-output-formatting.html">Форматирование данных</a>
<a class="list-group-item" href="./guide-output-pagination.html">Постраничная разбивка</a>
<a class="list-group-item" href="./guide-output-sorting.html">Сортировка</a>
<a class="list-group-item" href="./guide-output-data-providers.html">Провайдеры данных</a>
<a class="list-group-item" href="./guide-output-data-widgets.html">Виджеты для данных</a>
<a class="list-group-item" href="./guide-output-client-scripts.html">Работа с клиентскими скриптами</a>
<a class="list-group-item" href="./guide-output-theming.html">Темизация</a></div>
<a class="list-group-item active" href="#navigation-996" data-toggle="collapse" data-parent="#navigation">Безопасность <b class="caret"></b></a><div id="navigation-996" class="submenu panel-collapse collapse in"><a class="list-group-item" href="./guide-security-overview.html">Обзор</a>
<a class="list-group-item" href="./guide-security-authentication.html">Аутентификация</a>
<a class="list-group-item active" href="./guide-security-authorization.html">Авторизация</a>
<a class="list-group-item" href="./guide-security-passwords.html">Работа с паролями</a>
<a class="list-group-item" href="./guide-security-cryptography.html">Криптография</a>
<a class="list-group-item" href="https://github.com/yiisoft/yii2-authclient/blob/master/docs/guide-ru/README.md">Клиенты авторизации</a>
<a class="list-group-item" href="./guide-security-best-practices.html">Лучшие практики</a></div>
<a class="list-group-item" href="#navigation-997" data-toggle="collapse" data-parent="#navigation">Кеширование <b class="caret"></b></a><div id="navigation-997" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-caching-overview.html">Обзор</a>
<a class="list-group-item" href="./guide-caching-data.html">Кэширование данных</a>
<a class="list-group-item" href="./guide-caching-fragment.html">Кэширование фрагментов</a>
<a class="list-group-item" href="./guide-caching-page.html">Кэширование страниц</a>
<a class="list-group-item" href="./guide-caching-http.html">HTTP кэширование</a></div>
<a class="list-group-item" href="#navigation-998" data-toggle="collapse" data-parent="#navigation">Веб-сервисы REST <b class="caret"></b></a><div id="navigation-998" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-rest-quick-start.html">Быстрый старт</a>
<a class="list-group-item" href="./guide-rest-resources.html">Ресурсы</a>
<a class="list-group-item" href="./guide-rest-controllers.html">Контроллеры</a>
<a class="list-group-item" href="./guide-rest-routing.html">Роутинг</a>
<a class="list-group-item" href="./guide-rest-response-formatting.html">Форматирование ответа</a>
<a class="list-group-item" href="./guide-rest-authentication.html">Аутентификация</a>
<a class="list-group-item" href="./guide-rest-rate-limiting.html">Ограничение частоты запросов</a>
<a class="list-group-item" href="./guide-rest-versioning.html">Версионирование</a>
<a class="list-group-item" href="./guide-rest-error-handling.html">Обработка ошибок</a></div>
<a class="list-group-item" href="#navigation-999" data-toggle="collapse" data-parent="#navigation">Инструменты разработчика <b class="caret"></b></a><div id="navigation-999" class="submenu panel-collapse collapse"><a class="list-group-item" href="https://github.com/yiisoft/yii2-debug/blob/master/docs/guide/README.md">Отладочная панель и отладчик</a>
<a class="list-group-item" href="https://github.com/yiisoft/yii2-gii/blob/master/docs/guide/README.md">Генерация кода с Gii</a>
<a class="list-group-item" href="https://github.com/yiisoft/yii2-apidoc">Генератор документации API</a></div>
<a class="list-group-item" href="#navigation-1000" data-toggle="collapse" data-parent="#navigation">Тестирование <b class="caret"></b></a><div id="navigation-1000" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-test-overview.html">Обзор</a>
<a class="list-group-item" href="./guide-test-environment-setup.html">Настройка тестового окружения</a>
<a class="list-group-item" href="./guide-test-unit.html">Модульные тесты</a>
<a class="list-group-item" href="./guide-test-functional.html">Функциональные тесты</a>
<a class="list-group-item" href="./guide-test-acceptance.html">Приёмочные тесты</a>
<a class="list-group-item" href="./guide-test-fixtures.html">Фикстуры</a></div>
<a class="list-group-item" href="#navigation-1001" data-toggle="collapse" data-parent="#navigation">Специальные темы <b class="caret"></b></a><div id="navigation-1001" class="submenu panel-collapse collapse"><a class="list-group-item" href="https://github.com/yiisoft/yii2-app-advanced/blob/master/docs/guide/README.md">Шаблон приложения advanced</a>
<a class="list-group-item" href="./guide-tutorial-start-from-scratch.html">Создание приложения с нуля</a>
<a class="list-group-item" href="./guide-tutorial-console.html">Консольные команды</a>
<a class="list-group-item" href="./guide-tutorial-core-validators.html">Встроенные валидаторы</a>
<a class="list-group-item" href="./guide-tutorial-i18n.html">Интернационализация</a>
<a class="list-group-item" href="./guide-tutorial-mailing.html">Отправка почты</a>
<a class="list-group-item" href="./guide-tutorial-performance-tuning.html">Оптимизация производительности</a>
<a class="list-group-item" href="./guide-tutorial-shared-hosting.html">Окружение виртуального хостинга</a>
<a class="list-group-item" href="./guide-tutorial-template-engines.html">Шаблонизаторы</a>
<a class="list-group-item" href="./guide-tutorial-yii-integration.html">Работа со сторонним кодом</a>
<a class="list-group-item" href="./guide-tutorial-yii-as-micro-framework.html">Использование Yii в качестве микро-framework&#039;а</a></div>
<a class="list-group-item" href="#navigation-1002" data-toggle="collapse" data-parent="#navigation">Виджеты <b class="caret"></b></a><div id="navigation-1002" class="submenu panel-collapse collapse"><a class="list-group-item" href="http://www.yiiframework.com/doc-2.0/yii-grid-gridview.html">GridView</a>
<a class="list-group-item" href="http://www.yiiframework.com/doc-2.0/yii-widgets-listview.html">ListView</a>
<a class="list-group-item" href="http://www.yiiframework.com/doc-2.0/yii-widgets-detailview.html">DetailView</a>
<a class="list-group-item" href="http://www.yiiframework.com/doc-2.0/guide-input-forms.html#activerecord-based-forms-activeform">ActiveForm</a>
<a class="list-group-item" href="http://www.yiiframework.com/doc-2.0/yii-widgets-pjax.html">Pjax</a>
<a class="list-group-item" href="http://www.yiiframework.com/doc-2.0/yii-widgets-menu.html">Menu</a>
<a class="list-group-item" href="http://www.yiiframework.com/doc-2.0/yii-widgets-linkpager.html">LinkPager</a>
<a class="list-group-item" href="http://www.yiiframework.com/doc-2.0/yii-widgets-linksorter.html">LinkSorter</a>
<a class="list-group-item" href="https://github.com/yiisoft/yii2-bootstrap/blob/master/docs/guide-ru/README.md">Виджеты Bootstrap</a>
<a class="list-group-item" href="https://github.com/yiisoft/yii2-jui/blob/master/docs/guide-ru/README.md">Виджеты Jquery UI</a></div>
<a class="list-group-item" href="#navigation-1003" data-toggle="collapse" data-parent="#navigation">Хелперы <b class="caret"></b></a><div id="navigation-1003" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-helper-overview.html">Обзор</a>
<a class="list-group-item" href="./guide-helper-array.html">ArrayHelper</a>
<a class="list-group-item" href="./guide-helper-html.html">Html</a>
<a class="list-group-item" href="./guide-helper-url.html">Url хелпер</a></div></div>    </div>
    <div class="col-md-9 guide-content" role="main">
        <h1>Авторизация <span id="avtorizacia"></span><a href="#avtorizacia" class="hashlink">&para;</a></h1>
<div class="toc"><ol><li><a href="#filtry-kontrola-dostupa">Фильтры контроля доступа</a></li>
<li><a href="#kontrol-dostupa-na-osnove-rolej-rbac">Контроль доступа на основе ролей (RBAC)</a></li></ol></div>
<blockquote class="note"><p><strong>Примечание: </strong>этот раздел находится на стадии разработки.</p>
</blockquote>
<p>Авторизация — это процесс проверки того, что пользователь имеет достаточно прав, чтобы выполнить какие-то действия. Yii предоставляет два метода авторизации: фильтры контроля доступа (ACF) и контроль доступа на основе ролей (RBAC).</p>
<h2>Фильтры контроля доступа <span id="filtry-kontrola-dostupa"></span><a href="#filtry-kontrola-dostupa" class="hashlink">&para;</a></h2><p>Фильтры контроля доступа (ACF) являются простым методом, который лучше всего использовать в приложениях с простым
контролем доступа. Как видно из их названия, ACF — это фильтры, которые могут присоединяться к контроллеру
или модулю как поведение. ACF проверяет набор <a href="./yii-filters-accesscontrol.html#$rules-detail">правил доступа</a>, чтобы убедиться,
что пользователь имеет доступ к запрошенному действию.</p>
<p>Код ниже показывает, как использовать ACF фильтр, реализованный в <a href="./yii-filters-accesscontrol.html">yii\filters\AccessControl</a>:</p>
<pre><code class="hljs php language-php"><span class="hljs-keyword">use</span> <span class="hljs-title">yii</span>\<span class="hljs-title">filters</span>\<span class="hljs-title">AccessControl</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SiteController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Controller</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">behaviors</span><span class="hljs-params">()</span>
    </span>{
        <span class="hljs-keyword">return</span> [
            <span class="hljs-string">'access'</span> =&gt; [
                <span class="hljs-string">'class'</span> =&gt; AccessControl::className(),
                <span class="hljs-string">'only'</span> =&gt; [<span class="hljs-string">'login'</span>, <span class="hljs-string">'logout'</span>, <span class="hljs-string">'signup'</span>],
                <span class="hljs-string">'rules'</span> =&gt; [
                    [
                        <span class="hljs-string">'allow'</span> =&gt; <span class="hljs-keyword">true</span>,
                        <span class="hljs-string">'actions'</span> =&gt; [<span class="hljs-string">'login'</span>, <span class="hljs-string">'signup'</span>],
                        <span class="hljs-string">'roles'</span> =&gt; [<span class="hljs-string">'?'</span>],
                    ],
                    [
                        <span class="hljs-string">'allow'</span> =&gt; <span class="hljs-keyword">true</span>,
                        <span class="hljs-string">'actions'</span> =&gt; [<span class="hljs-string">'logout'</span>],
                        <span class="hljs-string">'roles'</span> =&gt; [<span class="hljs-string">'@'</span>],
                    ],
                ],
            ],
        ];
    }
    <span class="hljs-comment">// ...</span>
}
</code></pre>
<p>Код выше показывает ACF фильтр, связанный с контроллером <code>site</code> через поведение. Это типичный способ использования фильтров действий.
Параметр <code>only</code> указывает, что фильтр ACF нужно применять только к действиям <code>login</code>, <code>logout</code> и <code>signup</code>.
Параметр <code>rules</code> задаёт <a href="./yii-filters-accessrule.html">правила доступа</a>, которые означают следующее:</p>
<ul>
<li>Разрешить всем гостям (ещё не прошедшим авторизацию) доступ к действиям <code>login</code> и <code>signup</code>.
Опция <code>roles</code> содержит знак вопроса <code>?</code>, это специальный токен обозначающий "гостя".</li>
<li>Разрешить аутентифицированным пользователям доступ к действию <code>logout</code>. Символ <code>@</code> — это другой специальный токен,
обозначающий аутентифицированного пользователя.</li>
</ul>
<p>Когда фильтр ACF проводит проверку авторизации, он проверяет правила по одному сверху вниз, пока не найдёт совпадение.
Значение опции <code>allow</code> выбранного правила указывает, авторизовывать пользователя или нет. Если ни одно из правил
не совпало, то пользователь считается НЕавторизованным, и фильтр ACF останавливает дальнейшее выполнение действия.</p>
<p>По умолчанию, когда у пользователя отсутствует доступ к текущему действию, ACF делает следующее:</p>
<ul>
<li>Если пользователь гость, вызывается <a href="./yii-web-user.html#loginRequired()-detail">yii\web\User::loginRequired()</a>, который перенаправляет браузер на страницу входа.</li>
<li>Если пользователь авторизован, генерируется исключение <a href="./yii-web-forbiddenhttpexception.html">yii\web\ForbiddenHttpException</a>.</li>
</ul>
<p>Вы можете переопределить это поведение, настроив свойство <a href="./yii-filters-accesscontrol.html#$denyCallback-detail">yii\filters\AccessControl::$denyCallback</a>:</p>
<pre><code class="hljs php language-php">[
    <span class="hljs-string">'class'</span> =&gt; AccessControl::className(),
    <span class="hljs-string">'denyCallback'</span> =&gt; <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">($rule, $action)</span> </span>{
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> \<span class="hljs-keyword">Exception</span>(<span class="hljs-string">'У вас нет доступа к этой странице'</span>);
    }
]
</code></pre>
<p><a href="./yii-filters-accessrule.html">Правила доступа</a> поддерживают набор свойств. Ниже дано краткое описание поддерживаемых опций.
Вы также можете расширить <a href="./yii-filters-accessrule.html">yii\filters\AccessRule</a>, чтобы создать свой собственный класс правил доступа.</p>
<ul>
<li><p><a href="./yii-filters-accessrule.html#$allow-detail">allow</a>: задаёт какое это правило, "allow" или "deny".</p>
</li>
<li><p><a href="./yii-filters-accessrule.html#$actions-detail">actions</a>: задаёт действия, соответствующие этому правилу.
Значение должно быть массивом идентификаторов действий. Сравнение — регистрозависимо. Если свойство пустое или не задано,
то правило применяется ко всем действиям.</p>
</li>
<li><p><a href="./yii-filters-accessrule.html#$controllers-detail">controllers</a>: задаёт контроллеры, которым соответствует правило.
Значение должно быть массивом с идентификаторами контроллеров. Сравнение регистрозависимо. Если свойство
пустое или не задано, то правило применяется ко всем контроллерам.</p>
</li>
<li><p><a href="./yii-filters-accessrule.html#$roles-detail">roles</a>: задаёт роли пользователей, соответствующих этому правилу.
Распознаются две специальные роли, которые проверяются с помощью <a href="./yii-web-user.html#$isGuest-detail">yii\web\User::$isGuest</a>:</p>
<ul>
<li><code>?</code>: соответствует гостевому пользователю (не аутентифицирован),</li>
<li><code>@</code>: соответствует аутентифицированному пользователю.</li>
</ul>
<p>Использование других имён ролей будет приводить к вызову метода <a href="./yii-web-user.html#can()-detail">yii\web\User::can()</a>, который требует включения
RBAC (будет описано дальше). Если свойство пустое или не задано, то правило применяется ко всем ролям.</p>
</li>
<li><p><a href="./yii-filters-accessrule.html#$ips-detail">ips</a>: задаёт <a href="./yii-web-request.html#$userIP-detail">IP адреса пользователей</a>, для которых применяется это правило. IP адрес может содержать <code>*</code> в конце, так чтобы он соответствовал IP адресу с таким же префиксом.
Для примера, '192.168.*' соответствует всем IP адресам в сегменте '192.168.'. Если свойство пустое или не задано,
то правило применяется ко всем IP адресам.</p>
</li>
<li><p><a href="./yii-filters-accessrule.html#$verbs-detail">verbs</a>: задаёт http метод (например, <code>GET</code>, <code>POST</code>), соответствующий правилу.
Сравнение — регистронезависимо.</p>
</li>
<li><p><a href="./yii-filters-accessrule.html#$matchCallback-detail">matchCallback</a>: задаёт PHP колбек, который вызывается для определения,
что правило должно быть применено.</p>
</li>
<li><p><a href="./yii-filters-accessrule.html#$denyCallback-detail">denyCallback</a>: задаёт PHP колбек, который будет вызван, если доступ будет
запрещён при вызове этого правила.</p>
</li>
</ul>
<p>Ниже показан пример, показывающий использование опции <code>matchCallback</code>, которая позволяет писать произвольную
логику проверки доступа:</p>
<pre><code class="hljs php language-php"><span class="hljs-keyword">use</span> <span class="hljs-title">yii</span>\<span class="hljs-title">filters</span>\<span class="hljs-title">AccessControl</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SiteController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Controller</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">behaviors</span><span class="hljs-params">()</span>
    </span>{
        <span class="hljs-keyword">return</span> [
            <span class="hljs-string">'access'</span> =&gt; [
                <span class="hljs-string">'class'</span> =&gt; AccessControl::className(),
                <span class="hljs-string">'only'</span> =&gt; [<span class="hljs-string">'special-callback'</span>],
                <span class="hljs-string">'rules'</span> =&gt; [
                    [
                        <span class="hljs-string">'actions'</span> =&gt; [<span class="hljs-string">'special-callback'</span>],
                        <span class="hljs-string">'allow'</span> =&gt; <span class="hljs-keyword">true</span>,
                        <span class="hljs-string">'matchCallback'</span> =&gt; <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">($rule, $action)</span> </span>{
                            <span class="hljs-keyword">return</span> date(<span class="hljs-string">'d-m'</span>) === <span class="hljs-string">'31-10'</span>;
                        }
                    ],
                ],
            ],
        ];
    }

    <span class="hljs-comment">// Колбек сработал! Эта страница может быть отображена только 31-ого октября</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">actionSpecialCallback</span><span class="hljs-params">()</span>
    </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;render(<span class="hljs-string">'happy-halloween'</span>);
    }
}
</code></pre>
<h2>Контроль доступа на основе ролей (RBAC) <span id="kontrol-dostupa-na-osnove-rolej-rbac"></span><a href="#kontrol-dostupa-na-osnove-rolej-rbac" class="hashlink">&para;</a></h2><p>Управление доступом на основе ролей (RBAC) обеспечивает простой, но мощный централизованный контроль доступа.
Пожалуйста, обратитесь к <a href="https://ru.wikipedia.org/wiki/%D0%A3%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5_%D0%B4%D0%BE%D1%81%D1%82%D1%83%D0%BF%D0%BE%D0%BC_%D0%BD%D0%B0_%D0%BE%D1%81%D0%BD%D0%BE%D0%B2%D0%B5_%D1%80%D0%BE%D0%BB%D0%B5%D0%B9">Wikipedia</a>
для получения информации о сравнении RBAC с другими, более традиционными, системами контроля доступа.</p>
<p>Yii реализует общую иерархическую RBAC, следуя <a href="http://csrc.nist.gov/rbac/sandhu-ferraiolo-kuhn-00.pdf">NIST RBAC model</a>.
Обеспечивается функциональность RBAC через <a href="guide-structure-application-components.html">компонент приложения</a> <a href="./yii-rbac-managerinterface.html">authManager</a>.</p>
<p>Использование RBAC состоит из двух частей. Первая часть — это создание RBAC данных авторизации, и вторая часть — это
использование данных авторизации для проверки доступа в том месте, где это нужно.</p>
<p>Для облегчения последующего описания, мы сначала введём некоторые основные понятия RBAC.</p>
<h3>Основные концепции <span id="osnovnye-koncepcii"></span><a href="#osnovnye-koncepcii" class="hashlink">&para;</a></h3><p>Роль представляет собой набор разрешений (<em>permissions</em>) (например, создание сообщения, обновление сообщения).
Роль может быть назначена на одного или многих пользователей. Чтобы проверить, имеет ли пользователь указанные
разрешения, мы должны проверить, назначена ли пользователю роль, которая содержит данное разрешение.</p>
<p>С каждой ролью или разрешением может быть связано правило (<em>rule</em>). Правило представляет собой кусок кода, который будет
выполняться в ходе проверки доступа для определения может ли быть применена соответствующая роль или разрешение
к текущему пользователю. Например, разрешение "обновление поста" может иметь правило, которое проверяет является ли
текущий пользователь автором поста. Во время проверки доступа, если пользователь не является автором поста, он/она будет
считаться не имеющими разрешения "обновление поста".</p>
<p>И роли, и разрешения могут быть организованы в иерархию. В частности, роль может содержать другие роли или разрешения; и
разрешения могут содержать другие разрешения. Yii реализует <em>частично упорядоченную</em> иерархию, которая включает в себя
специальные <em>деревья</em> иерархии. Роль может содержать разрешение, но обратное не верно.</p>
<h3>Настройка RBAC Manager <span id="nastrojka-rbac-manager"></span><a href="#nastrojka-rbac-manager" class="hashlink">&para;</a></h3><p>Перед определением авторизационных данных и проверкой прав доступа, мы должны настроить компонент приложения
<a href="./yii-base-application.html#$authManager-detail">authManager</a>. Yii предоставляет два типа менеджеров авторизации:
<a href="./yii-rbac-phpmanager.html">yii\rbac\PhpManager</a> и <a href="./yii-rbac-dbmanager.html">yii\rbac\DbManager</a>. Первый использует файл с PHP скриптом для хранения данных авторизации,
второй сохраняет данные в базе данных. Вы можете использовать первый, если ваше приложение не требует слишком динамичного
управления ролями и разрешениями.</p>
<h4>Настройка authManager с помощью <code>PhpManager</code> <span id="nastrojka-authmanager-s-pomosu-phpmanager"></span><a href="#nastrojka-authmanager-s-pomosu-phpmanager" class="hashlink">&para;</a></h4><p>Следующий код показывает как настроить в конфигурации приложения <code>authManager</code> с использованием класса <a href="./yii-rbac-phpmanager.html">yii\rbac\PhpManager</a>:</p>
<pre><code class="hljs php language-php"><span class="hljs-keyword">return</span> [
    <span class="hljs-comment">// ...</span>
    <span class="hljs-string">'components'</span> =&gt; [
        <span class="hljs-string">'authManager'</span> =&gt; [
            <span class="hljs-string">'class'</span> =&gt; <span class="hljs-string">'yii\rbac\PhpManager'</span>,
        ],
        <span class="hljs-comment">// ...</span>
    ],
];
</code></pre>
<p>Теперь <code>authManager</code> может быть доступен через <code>\Yii::$app-&gt;authManager</code>.</p>
<blockquote><p>Замечание: По умолчанию, <a href="./yii-rbac-phpmanager.html">yii\rbac\PhpManager</a> сохраняет данные RBAC в файлах в директории <code>@app/rbac/</code>. Убедитесь
  что данная директория и файлы в них доступны для записи Web серверу, если иерархия разрешений должна меняться онлайн.</p>
</blockquote>
<h4>Настройка authManager с помощью <code>DbManager</code> <span id="nastrojka-authmanager-s-pomosu-dbmanager"></span><a href="#nastrojka-authmanager-s-pomosu-dbmanager" class="hashlink">&para;</a></h4><p>Следующий код показывает как настроить в конфигурации приложения <code>authManager</code> с использованием класса <a href="./yii-rbac-dbmanager.html">yii\rbac\DbManager</a>:</p>
<pre><code class="hljs php language-php"><span class="hljs-keyword">return</span> [
    <span class="hljs-comment">// ...</span>
    <span class="hljs-string">'components'</span> =&gt; [
        <span class="hljs-string">'authManager'</span> =&gt; [
            <span class="hljs-string">'class'</span> =&gt; <span class="hljs-string">'yii\rbac\DbManager'</span>,
        ],
        <span class="hljs-comment">// ...</span>
    ],
];
</code></pre>
<blockquote><p>Примечание: Если вы используете шаблон проекта basic, компонент <code>authManager</code> необходимо настроить как в <code>config/web.php</code>, так и в
<a href="guide-tutorial-console.html#configuration">конфигурации консольного приложения</a> <code>config/console.php</code>.
При использовании шаблона проекта advanced <code>authManager</code> достаточно настроить единожды в <code>common/config/main.php</code>.</p>
</blockquote>
<p><code>DbManager</code> использует четыре таблицы для хранения данных:</p>
<ul>
<li><a href="./yii-rbac-dbmanager.html#$itemTable-detail">itemTable</a>: таблица для хранения авторизационных элементов. По умолчанию "auth_item".</li>
<li><a href="./yii-rbac-dbmanager.html#$itemChildTable-detail">itemChildTable</a>: таблица для хранения иерархии элементов. По умолчанию "auth_item_child".</li>
<li><a href="./yii-rbac-dbmanager.html#$assignmentTable-detail">assignmentTable</a>: таблица для хранения назначений элементов авторизации. По умолчанию "auth_assignment".</li>
<li><a href="./yii-rbac-dbmanager.html#$ruleTable-detail">ruleTable</a>: таблица для хранения правил. По умолчанию "auth_rule".</li>
</ul>
<p>Прежде чем вы начнёте использовать этот менеджер, вам нужно создать таблицы в базе данных. Чтобы сделать это,
вы можете использовать миграцию хранящуюся в файле <code>@yii/rbac/migrations</code>:</p>
<p><code>yii migrate --migrationPath=@yii/rbac/migrations</code></p>
<p>Теперь <code>authManager</code> может быть доступен через <code>\Yii::$app-&gt;authManager</code>.</p>
<h3>Создание данных авторизации <span id="sozdanie-dannyh-avtorizacii"></span><a href="#sozdanie-dannyh-avtorizacii" class="hashlink">&para;</a></h3><p>Для создания данных авторизации нужно выполнить следующие задачи:</p>
<ul>
<li>определение ролей и разрешений;</li>
<li>установка отношений между ролями и правами доступа;</li>
<li>определение правил;</li>
<li>связывание правил с ролями и разрешениями;</li>
<li>назначение ролей пользователям.</li>
</ul>
<p>В зависимости от требований к гибкости авторизации перечисленные задачи могут быть выполнены разными путями.</p>
<p>Если иерархия прав не меняется, и количество пользователей зафиксировано, вы можете создать
<a href="guide-tutorial-console.html#create-command">консольную команду</a>, которая будет единожды инициализировать данные
через APIs, предоставляемое <code>authManager</code>:</p>
<pre><code class="hljs php language-php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">app</span>\<span class="hljs-title">commands</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">Yii</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">yii</span>\<span class="hljs-title">console</span>\<span class="hljs-title">Controller</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RbacController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Controller</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">actionInit</span><span class="hljs-params">()</span>
    </span>{
        $auth = Yii::$app-&gt;authManager;

        <span class="hljs-comment">// добавляем разрешение "createPost"</span>
        $createPost = $auth-&gt;createPermission(<span class="hljs-string">'createPost'</span>);
        $createPost-&gt;description = <span class="hljs-string">'Create a post'</span>;
        $auth-&gt;add($createPost);

        <span class="hljs-comment">// добавляем разрешение "updatePost"</span>
        $updatePost = $auth-&gt;createPermission(<span class="hljs-string">'updatePost'</span>);
        $updatePost-&gt;description = <span class="hljs-string">'Update post'</span>;
        $auth-&gt;add($updatePost);

        <span class="hljs-comment">// добавляем роль "author" и даём роли разрешение "createPost"</span>
        $author = $auth-&gt;createRole(<span class="hljs-string">'author'</span>);
        $auth-&gt;add($author);
        $auth-&gt;addChild($author, $createPost);

        <span class="hljs-comment">// добавляем роль "admin" и даём роли разрешение "updatePost"</span>
        <span class="hljs-comment">// а также все разрешения роли "author"</span>
        $admin = $auth-&gt;createRole(<span class="hljs-string">'admin'</span>);
        $auth-&gt;add($admin);
        $auth-&gt;addChild($admin, $updatePost);
        $auth-&gt;addChild($admin, $author);

        <span class="hljs-comment">// Назначение ролей пользователям. 1 и 2 это IDs возвращаемые IdentityInterface::getId()</span>
        <span class="hljs-comment">// обычно реализуемый в модели User.</span>
        $auth-&gt;assign($author, <span class="hljs-number">2</span>);
        $auth-&gt;assign($admin, <span class="hljs-number">1</span>);
    }
}
</code></pre>
<blockquote class="note"><p><strong>Примечание: </strong>Если вы используете шаблон проекта advanced, <code>RbacController</code> необходимо создать в директории <code>console/controllers</code>
  и сменить пространство имён на <code>console\controllers</code>.</p>
</blockquote>
<p>После выполнения команды <code>yii rbac/init</code> мы получим следующую иерархию:</p>
<p><img src="images/rbac-hierarchy-1.png" alt="Простая иерархия RBAC" title="Простая иерархия RBAC" /></p>
<p>Автор может создавать пост, администратор может обновлять пост и делать всё, что может делать автор.</p>
<p>Если ваше приложение позволяет регистрировать пользователей, то вам необходимо сразу назначать роли этим новым пользователям.
Например, для того, чтобы все вошедшие пользователи могли стать авторами в расширенном шаблоне проекта, вы должны изменить
<code>frontend\models\SignupForm::signup()</code> как показано ниже:</p>
<pre><code class="hljs php language-php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">signup</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;validate()) {
        $user = <span class="hljs-keyword">new</span> User();
        $user-&gt;username = <span class="hljs-keyword">$this</span>-&gt;username;
        $user-&gt;email = <span class="hljs-keyword">$this</span>-&gt;email;
        $user-&gt;setPassword(<span class="hljs-keyword">$this</span>-&gt;password);
        $user-&gt;generateAuthKey();
        $user-&gt;save(<span class="hljs-keyword">false</span>);

        <span class="hljs-comment">// нужно добавить следующие три строки:</span>
        $auth = Yii::$app-&gt;authManager;
        $authorRole = $auth-&gt;getRole(<span class="hljs-string">'author'</span>);
        $auth-&gt;assign($authorRole, $user-&gt;getId());

        <span class="hljs-keyword">return</span> $user;
    }

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
}
</code></pre>
<p>Для приложений, требующих комплексного контроля доступа с динамически обновляемыми данными авторизации, существуют
специальные пользовательские интерфейсы (так называемые админ-панели), которые могут быть разработаны с
использованием API, предлагаемого <code>authManager</code>.</p>
<h3>Использование правил <span id="ispolzovanie-pravil"></span><a href="#ispolzovanie-pravil" class="hashlink">&para;</a></h3><p>Как упомянуто выше, правила добавляют дополнительные ограничения на роли и разрешения. Правила — это классы, расширяющие
<a href="./yii-rbac-rule.html">yii\rbac\Rule</a>. Они должны реализовывать метод <a href="./yii-rbac-rule.html#execute()-detail">execute()</a>. В иерархии, созданной нами ранее,
автор не может редактировать свой пост. Давайте исправим это. Сначала мы должны создать правило, проверяющее
что пользователь является автором поста:</p>
<pre><code class="hljs php language-php"><span class="hljs-keyword">namespace</span> <span class="hljs-title">app</span>\<span class="hljs-title">rbac</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">yii</span>\<span class="hljs-title">rbac</span>\<span class="hljs-title">Rule</span>;

<span class="hljs-comment">/**
 * Проверяем authorID на соответствие с пользователем, переданным через параметры
 */</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AuthorRule</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Rule</span>
</span>{
    <span class="hljs-keyword">public</span> $name = <span class="hljs-string">'isAuthor'</span>;

    <span class="hljs-comment">/**
     * <span class="hljs-doctag">@param</span> string|int $user the user ID.
     * <span class="hljs-doctag">@param</span> Item $item the role or permission that this rule is associated width.
     * <span class="hljs-doctag">@param</span> array $params parameters passed to ManagerInterface::checkAccess().
     * <span class="hljs-doctag">@return</span> bool a value indicating whether the rule permits the role or permission it is associated with.
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">execute</span><span class="hljs-params">($user, $item, $params)</span>
    </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">isset</span>($params[<span class="hljs-string">'post'</span>]) ? $params[<span class="hljs-string">'post'</span>]-&gt;createdBy == $user : <span class="hljs-keyword">false</span>;
    }
}
</code></pre>
<p>Правило выше проверяет, что <code>post</code> был создан <code>$user</code>. Мы создадим специальное разрешение <code>updateOwnPost</code> в команде,
которую мы использовали ранее:</p>
<pre><code class="hljs php language-php">$auth = Yii::$app-&gt;authManager;

<span class="hljs-comment">// add the rule</span>
$rule = <span class="hljs-keyword">new</span> \app\rbac\AuthorRule;
$auth-&gt;add($rule);

<span class="hljs-comment">// добавляем разрешение "updateOwnPost" и привязываем к нему правило.</span>
$updateOwnPost = $auth-&gt;createPermission(<span class="hljs-string">'updateOwnPost'</span>);
$updateOwnPost-&gt;description = <span class="hljs-string">'Update own post'</span>;
$updateOwnPost-&gt;ruleName = $rule-&gt;name;
$auth-&gt;add($updateOwnPost);

<span class="hljs-comment">// "updateOwnPost" будет использоваться из "updatePost"</span>
$auth-&gt;addChild($updateOwnPost, $updatePost);

<span class="hljs-comment">// разрешаем "автору" обновлять его посты</span>
$auth-&gt;addChild($author, $updateOwnPost);
</code></pre>
<p>Теперь мы имеем следующую иерархию:</p>
<p><img src="images/rbac-hierarchy-2.png" alt="Иерархия RBAC с правилом" title="Иерархия RBAC с правилом" /></p>
<h3>Проверка доступа <span id="proverka-dostupa"></span><a href="#proverka-dostupa" class="hashlink">&para;</a></h3><p>С готовыми авторизационными данными проверка доступа — это просто вызов метода <a href="./yii-rbac-checkaccessinterface.html#checkAccess()-detail">yii\rbac\ManagerInterface::checkAccess()</a>.
Так как большинство проверок доступа относятся к текущему пользователю, для удобства Yii предоставляет сокращённый метод
<a href="./yii-web-user.html#can()-detail">yii\web\User::can()</a>, который можно использовать как показано ниже:</p>
<pre><code class="hljs php language-php"><span class="hljs-keyword">if</span> (\Yii::$app-&gt;user-&gt;can(<span class="hljs-string">'createPost'</span>)) {
    <span class="hljs-comment">// create post</span>
}
</code></pre>
<p>Если текущий пользователь Jane с ID=1, мы начнём с <code>createPost</code> и попробуем добраться до <code>Jane</code>:</p>
<p><img src="images/rbac-access-check-1.png" alt="Проверка доступа" title="Проверка доступа" /></p>
<p>Для того чтобы проверить, может ли пользователь обновить пост, нам надо передать дополнительный параметр,
необходимый для правила <code>AuthorRule</code>, описанного ранее:</p>
<pre><code class="hljs php language-php"><span class="hljs-keyword">if</span> (\Yii::$app-&gt;user-&gt;can(<span class="hljs-string">'updatePost'</span>, [<span class="hljs-string">'post'</span> =&gt; $post])) {
    <span class="hljs-comment">// update post</span>
}
</code></pre>
<p>Вот что происходит если текущим пользователем является John:</p>
<p><img src="images/rbac-access-check-2.png" alt="Проверка доступа" title="Проверка доступа" /></p>
<p>Мы начинаем с <code>updatePost</code> и переходим к <code>updateOwnPost</code>. Для того чтобы это произошло, правило <code>AuthorRule</code> должно вернуть
<code>true</code> при вызове метода <code>execute</code>. Метод получает <code>$params</code>, переданный при вызове метода <code>can</code>, значение которого равно
<code>['post' =&gt; $post]</code>. Если всё правильно, мы увидим, что <code>author</code> привязан к John.</p>
<p>В случае Jane это немного проще, потому что она admin:</p>
<p><img src="images/rbac-access-check-3.png" alt="Проверка доступа" title="Проверка доступа" /></p>
<p>Есть несколько способов реализовать авторизацию в контроллере. Если вам необходимы отдельные права на
добавление и удаление, то проверку стоит делать в каждом действии. Вы можете либо использовать условие выше в каждом
методе действия, либо использовать <a href="./yii-filters-accesscontrol.html">yii\filters\AccessControl</a>:</p>
<pre><code class="hljs php language-php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">behaviors</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-keyword">return</span> [
        <span class="hljs-string">'access'</span> =&gt; [
            <span class="hljs-string">'class'</span> =&gt; AccessControl::className(),
            <span class="hljs-string">'rules'</span> =&gt; [
                [
                    <span class="hljs-string">'allow'</span> =&gt; <span class="hljs-keyword">true</span>,
                    <span class="hljs-string">'actions'</span> =&gt; [<span class="hljs-string">'index'</span>],
                    <span class="hljs-string">'roles'</span> =&gt; [<span class="hljs-string">'managePost'</span>],
                ],
                [
                    <span class="hljs-string">'allow'</span> =&gt; <span class="hljs-keyword">true</span>,
                    <span class="hljs-string">'actions'</span> =&gt; [<span class="hljs-string">'view'</span>],
                    <span class="hljs-string">'roles'</span> =&gt; [<span class="hljs-string">'viewPost'</span>],
                ],
                [
                    <span class="hljs-string">'allow'</span> =&gt; <span class="hljs-keyword">true</span>,
                    <span class="hljs-string">'actions'</span> =&gt; [<span class="hljs-string">'create'</span>],
                    <span class="hljs-string">'roles'</span> =&gt; [<span class="hljs-string">'createPost'</span>],
                ],
                [
                    <span class="hljs-string">'allow'</span> =&gt; <span class="hljs-keyword">true</span>,
                    <span class="hljs-string">'actions'</span> =&gt; [<span class="hljs-string">'update'</span>],
                    <span class="hljs-string">'roles'</span> =&gt; [<span class="hljs-string">'updatePost'</span>],
                ],
                [
                    <span class="hljs-string">'allow'</span> =&gt; <span class="hljs-keyword">true</span>,
                    <span class="hljs-string">'actions'</span> =&gt; [<span class="hljs-string">'delete'</span>],
                    <span class="hljs-string">'roles'</span> =&gt; [<span class="hljs-string">'deletePost'</span>],
                ],
            ],
        ],
    ];
}
</code></pre>
<p>Если права на все CRUD операции выдаются вместе, то лучшее решение в этом случае — завести одно разрешение
вроде <code>managePost</code> и проверять его в <a href="./yii-web-controller.html#beforeAction()-detail">yii\web\Controller::beforeAction()</a>.</p>
<h3>Использование роли по умолчанию <span id="ispolzovanie-roli-po-umolcaniu"></span><a href="#ispolzovanie-roli-po-umolcaniu" class="hashlink">&para;</a></h3><p>Роль по умолчанию — это роль, которая <em>неявно</em> присваивается <em>всем</em> пользователям. Вызов метода
<a href="./yii-rbac-managerinterface.html#assign()-detail">yii\rbac\ManagerInterface::assign()</a> не требуется, и авторизационные данные не содержат информации о назначении.</p>
<p>Роль по умолчанию обычно связывают с правилом, определяющим к какой роли принадлежит каждый пользователь.</p>
<p>Роли по умолчанию обычно используются в приложениях, которые уже имеют какое-то описание ролей. Для примера, приложение
может иметь столбец "group" в таблице пользователей, и каждый пользователь принадлежит к какой-то группе. Если каждая
группа может быть сопоставлена роли в модели RBAC, вы можете использовать роль по умолчанию для автоматического назначения
каждому пользователю роли RBAC. Давайте используем пример, чтобы понять как это можно сделать.</p>
<p>Предположим что в таблице пользователей у вас есть столбец <code>group</code>, в котором значение 1 представляет группу "администратор",
а 2 — группу "автор". Вы планируете иметь две RBAC роли: <code>admin</code> и <code>author</code>, представляющие разрешения для двух
соответствующих групп. Вы можете настроить данные роли как показано ниже.</p>
<pre><code class="hljs php language-php"><span class="hljs-keyword">namespace</span> <span class="hljs-title">app</span>\<span class="hljs-title">rbac</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">Yii</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">yii</span>\<span class="hljs-title">rbac</span>\<span class="hljs-title">Rule</span>;

<span class="hljs-comment">/**
 * Checks if user group matches
 */</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserGroupRule</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Rule</span>
</span>{
    <span class="hljs-keyword">public</span> $name = <span class="hljs-string">'userGroup'</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">execute</span><span class="hljs-params">($user, $item, $params)</span>
    </span>{
        <span class="hljs-keyword">if</span> (!Yii::$app-&gt;user-&gt;isGuest) {
            $group = Yii::$app-&gt;user-&gt;identity-&gt;group;
            <span class="hljs-keyword">if</span> ($item-&gt;name === <span class="hljs-string">'admin'</span>) {
                <span class="hljs-keyword">return</span> $group == <span class="hljs-number">1</span>;
            } <span class="hljs-keyword">elseif</span> ($item-&gt;name === <span class="hljs-string">'author'</span>) {
                <span class="hljs-keyword">return</span> $group == <span class="hljs-number">1</span> || $group == <span class="hljs-number">2</span>;
            }
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
    }
}

$auth = Yii::$app-&gt;authManager;

$rule = <span class="hljs-keyword">new</span> \app\rbac\UserGroupRule;
$auth-&gt;add($rule);

$author = $auth-&gt;createRole(<span class="hljs-string">'author'</span>);
$author-&gt;ruleName = $rule-&gt;name;
$auth-&gt;add($author);
<span class="hljs-comment">// ... add permissions as children of $author ...</span>

$admin = $auth-&gt;createRole(<span class="hljs-string">'admin'</span>);
$admin-&gt;ruleName = $rule-&gt;name;
$auth-&gt;add($admin);
$auth-&gt;addChild($admin, $author);
<span class="hljs-comment">// ... add permissions as children of $admin ...</span>
</code></pre>
<p>Обратите внимание, так как "author" добавлен как дочерняя роль к "admin", следовательно, в реализации метода <code>execute()</code>
класса правила вы должны учитывать эту иерархию. Именно поэтому для роли "author" метод <code>execute()</code> вернёт истину,
если пользователь принадлежит к группам 1 или 2 (это означает, что пользователь находится в группе
администраторов или авторов)</p>
<p>Далее настроим <code>authManager</code> с помощью перечисления ролей в свойстве <a href="./yii-rbac-basemanager.html#$defaultRoles-detail">yii\rbac\BaseManager::$defaultRoles</a>:</p>
<pre><code class="hljs php language-php"><span class="hljs-keyword">return</span> [
    <span class="hljs-comment">// ...</span>
    <span class="hljs-string">'components'</span> =&gt; [
        <span class="hljs-string">'authManager'</span> =&gt; [
            <span class="hljs-string">'class'</span> =&gt; <span class="hljs-string">'yii\rbac\PhpManager'</span>,
            <span class="hljs-string">'defaultRoles'</span> =&gt; [<span class="hljs-string">'admin'</span>, <span class="hljs-string">'author'</span>],
        ],
        <span class="hljs-comment">// ...</span>
    ],
];
</code></pre>
<p>Теперь, если вы выполните проверку доступа, для обоих ролей <code>admin</code> и <code>author</code> будет выполнена проверка правила,
асоциированного с ними. Если правило вернёт истину, это будет означать, что роль применяется к текущему пользователю.
На основании правила, реализованного выше: если пользователь входит в группу 1, пользователю будет назначена роль <code>admin</code>;
и если значение <code>group</code> равно 2, будет применена роль <code>author</code>.</p>
        <div class="toplink"><a href="#" class="h1" title="go to top"><span class="glyphicon glyphicon-arrow-up"></a></div>
    </div>
</div>


</div>

<footer class="footer">
        <p class="pull-right"><small>Page generated on Wed, 09 Dec 2020 00:16:06 +0000</small></p>
    Powered by <a href="http://www.yiiframework.com/" rel="external">Yii Framework</a></footer>

<script>jQuery(function ($) {
    var shiftWindow = function () { scrollBy(0, -50) };
    if (location.hash) setTimeout(shiftWindow, 1);
    window.addEventListener("hashchange", shiftWindow);
var element = document.createElement("script");
element.src = "./jssearch.index.js";
document.body.appendChild(element);

var searchBox = $('#searchbox');

// search when typing in search field
searchBox.on("keyup", function(event) {
    var query = $(this).val();

    if (query == '' || event.which == 27) {
        $('#search-resultbox').hide();
        return;
    } else if (event.which == 13) {
        var selectedLink = $('#search-resultbox a.selected');
        if (selectedLink.length != 0) {
            document.location = selectedLink.attr('href');
            return;
        }
    } else if (event.which == 38 || event.which == 40) {
        $('#search-resultbox').show();

        var selected = $('#search-resultbox a.selected');
        if (selected.length == 0) {
            $('#search-results').find('a').first().addClass('selected');
        } else {
            var next;
            if (event.which == 40) {
                next = selected.parent().next().find('a').first();
            } else {
                next = selected.parent().prev().find('a').first();
            }
            if (next.length != 0) {
                var resultbox = $('#search-results');
                var position = next.position();

//              TODO scrolling is buggy and jumps around
//                resultbox.scrollTop(Math.floor(position.top));
//                console.log(position.top);

                selected.removeClass('selected');
                next.addClass('selected');
            }
        }

        return;
    }
    $('#search-resultbox').show();
    $('#search-results').html('<li><span class="no-results">No results</span></li>');

    var result = jssearch.search(query);

    if (result.length > 0) {
        var i = 0;
        var resHtml = '';

        for (var key in result) {
            if (i++ > 20) {
                break;
            }
            resHtml = resHtml +
            '<li><a href="' + result[key].file.u.substr(3) +'"><span class="title">' + result[key].file.t + '</span>' +
            '<span class="description">' + result[key].file.d + '</span></a></li>';
        }
        $('#search-results').html(resHtml);
    }
});

// hide the search results on ESC
$(document).on("keyup", function(event) { if (event.which == 27) { $('#search-resultbox').hide(); } });
// hide search results on click to document
$(document).bind('click', function (e) { $('#search-resultbox').hide(); });
// except the following:
searchBox.bind('click', function(e) { e.stopPropagation(); });
$('#search-resultbox').bind('click', function(e) { e.stopPropagation(); });

});</script></body>
</html>
