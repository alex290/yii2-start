<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="language" content="en" />
        
<link href="./assets/1728b664/css/bootstrap.css" rel="stylesheet">
<link href="./assets/9c5d0894/solarized_light.css" rel="stylesheet">
<link href="./assets/f2ce5bcd/style.css" rel="stylesheet">
<script src="./assets/bbf84a7a/jquery.js"></script>
<script src="./assets/1728b664/js/bootstrap.js"></script>
<script src="./assets/fd63b446/jssearch.js"></script>    <title>Лучшие практики - Безопасность - The Definitive Guide to Yii 2.0</title>
</head>
<body>

<div class="wrap">
    <nav id="w567" class="navbar-inverse navbar-fixed-top navbar"><div class="navbar-header"><button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#w567-collapse"><span class="sr-only">Toggle navigation</span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
<span class="icon-bar"></span></button><a class="navbar-brand" href="./index.html">The Definitive Guide to Yii 2.0</a></div><div id="w567-collapse" class="collapse navbar-collapse"><ul id="w568" class="navbar-nav nav"><li><a href="./index.html">Class reference</a></li>
<li class="dropdown"><a class="dropdown-toggle" href="#" data-toggle="dropdown">Extensions <span class="caret"></span></a><ul id="w569" class="dropdown-menu"><li><a href="./ext-apidoc-index.html" tabindex="-1">apidoc</a></li>
<li><a href="./ext-authclient-index.html" tabindex="-1">authclient</a></li>
<li><a href="./ext-bootstrap-index.html" tabindex="-1">bootstrap</a></li>
<li><a href="./ext-debug-index.html" tabindex="-1">debug</a></li>
<li><a href="./ext-elasticsearch-index.html" tabindex="-1">elasticsearch</a></li>
<li><a href="./ext-faker-index.html" tabindex="-1">faker</a></li>
<li><a href="./ext-gii-index.html" tabindex="-1">gii</a></li>
<li><a href="./ext-httpclient-index.html" tabindex="-1">httpclient</a></li>
<li><a href="./ext-imagine-index.html" tabindex="-1">imagine</a></li>
<li><a href="./ext-jui-index.html" tabindex="-1">jui</a></li>
<li><a href="./ext-mongodb-index.html" tabindex="-1">mongodb</a></li>
<li><a href="./ext-redis-index.html" tabindex="-1">redis</a></li>
<li><a href="./ext-shell-index.html" tabindex="-1">shell</a></li>
<li><a href="./ext-smarty-index.html" tabindex="-1">smarty</a></li>
<li><a href="./ext-sphinx-index.html" tabindex="-1">sphinx</a></li>
<li><a href="./ext-swiftmailer-index.html" tabindex="-1">swiftmailer</a></li>
<li><a href="./ext-twig-index.html" tabindex="-1">twig</a></li></ul></li>
<li><a href="./guide-README.html">Guide</a></li></ul><div class="navbar-form navbar-left" role="search">
  <div class="form-group">
    <input id="searchbox" type="text" class="form-control" placeholder="Search">
  </div>
</div>
</div></nav>
    <div id="search-resultbox" style="display: none;" class="modal-content">
        <ul id="search-results">
        </ul>
    </div>

    
<div class="row">
    <div class="col-md-2">
                <div id="navigation" class="list-group"><a class="list-group-item" href="#navigation-551" data-toggle="collapse" data-parent="#navigation">Введение <b class="caret"></b></a><div id="navigation-551" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-intro-yii.html">О Yii</a>
<a class="list-group-item" href="./guide-intro-upgrade-from-v1.html">Обновление с версии 1.1</a></div>
<a class="list-group-item" href="#navigation-552" data-toggle="collapse" data-parent="#navigation">Первое знакомство <b class="caret"></b></a><div id="navigation-552" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-start-installation.html">Установка Yii</a>
<a class="list-group-item" href="./guide-start-workflow.html">Запуск приложения</a>
<a class="list-group-item" href="./guide-start-hello.html">Говорим «привет»</a>
<a class="list-group-item" href="./guide-start-forms.html">Работа с формами</a>
<a class="list-group-item" href="./guide-start-databases.html">Работа с базами данных</a>
<a class="list-group-item" href="./guide-start-gii.html">Генерация кода при помощи Gii</a>
<a class="list-group-item" href="./guide-start-looking-ahead.html">Что дальше?</a></div>
<a class="list-group-item" href="#navigation-553" data-toggle="collapse" data-parent="#navigation">Структура приложения <b class="caret"></b></a><div id="navigation-553" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-structure-overview.html">Обзор</a>
<a class="list-group-item" href="./guide-structure-entry-scripts.html">Входные скрипты</a>
<a class="list-group-item" href="./guide-structure-applications.html">Приложения</a>
<a class="list-group-item" href="./guide-structure-application-components.html">Компоненты приложения</a>
<a class="list-group-item" href="./guide-structure-controllers.html">Контроллеры</a>
<a class="list-group-item" href="./guide-structure-models.html">Модели</a>
<a class="list-group-item" href="./guide-structure-views.html">Представления</a>
<a class="list-group-item" href="./guide-structure-modules.html">Модули</a>
<a class="list-group-item" href="./guide-structure-filters.html">Фильтры</a>
<a class="list-group-item" href="./guide-structure-widgets.html">Виджеты</a>
<a class="list-group-item" href="./guide-structure-assets.html">Ресурсы</a>
<a class="list-group-item" href="./guide-structure-extensions.html">Расширения</a></div>
<a class="list-group-item" href="#navigation-554" data-toggle="collapse" data-parent="#navigation">Обработка запросов <b class="caret"></b></a><div id="navigation-554" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-runtime-overview.html">Обзор</a>
<a class="list-group-item" href="./guide-runtime-bootstrapping.html">Bootstrapping</a>
<a class="list-group-item" href="./guide-runtime-routing.html">Разбор и генерация URL</a>
<a class="list-group-item" href="./guide-runtime-requests.html">Запросы</a>
<a class="list-group-item" href="./guide-runtime-responses.html">Ответы</a>
<a class="list-group-item" href="./guide-runtime-sessions-cookies.html">Сессии и куки</a>
<a class="list-group-item" href="./guide-runtime-handling-errors.html">Обработка ошибок</a>
<a class="list-group-item" href="./guide-runtime-logging.html">Логирование</a></div>
<a class="list-group-item" href="#navigation-555" data-toggle="collapse" data-parent="#navigation">Основные понятия <b class="caret"></b></a><div id="navigation-555" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-concept-components.html">Компоненты</a>
<a class="list-group-item" href="./guide-concept-properties.html">Свойства</a>
<a class="list-group-item" href="./guide-concept-events.html">События</a>
<a class="list-group-item" href="./guide-concept-behaviors.html">Поведения</a>
<a class="list-group-item" href="./guide-concept-configurations.html">Конфигурации</a>
<a class="list-group-item" href="./guide-concept-aliases.html">Псевдонимы</a>
<a class="list-group-item" href="./guide-concept-autoloading.html">Автозагрузка классов</a>
<a class="list-group-item" href="./guide-concept-service-locator.html">Service Locator</a>
<a class="list-group-item" href="./guide-concept-di-container.html">Dependency Injection Container</a></div>
<a class="list-group-item" href="#navigation-556" data-toggle="collapse" data-parent="#navigation">Работа с базами данных <b class="caret"></b></a><div id="navigation-556" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-db-dao.html">Объекты доступа к данным (DAO)</a>
<a class="list-group-item" href="./guide-db-query-builder.html">Построитель запросов</a>
<a class="list-group-item" href="./guide-db-active-record.html">Active Record</a>
<a class="list-group-item" href="./guide-db-migrations.html">Миграции</a>
<a class="list-group-item" href="https://github.com/yiisoft/yii2-sphinx/blob/master/docs/guide-ru/README.md">Sphinx</a>
<a class="list-group-item" href="https://github.com/yiisoft/yii2-redis/blob/master/docs/guide-ru/README.md">Redis</a>
<a class="list-group-item" href="https://github.com/yiisoft/yii2-mongodb/blob/master/docs/guide-ru/README.md">MongoDB</a>
<a class="list-group-item" href="https://github.com/yiisoft/yii2-elasticsearch/blob/master/docs/guide-ru/README.md">ElasticSearch</a></div>
<a class="list-group-item" href="#navigation-557" data-toggle="collapse" data-parent="#navigation">Получение данных от пользователя <b class="caret"></b></a><div id="navigation-557" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-input-forms.html">Создание форм</a>
<a class="list-group-item" href="./guide-input-validation.html">Валидация</a>
<a class="list-group-item" href="./guide-input-file-upload.html">Загрузка файлов</a>
<a class="list-group-item" href="./guide-input-tabular-input.html">Табличный ввод</a>
<a class="list-group-item" href="./guide-input-multiple-models.html">Работа с несколькими моделями</a>
<a class="list-group-item" href="./guide-input-form-javascript.html">Расширение ActiveForm на стороне клиента</a></div>
<a class="list-group-item" href="#navigation-558" data-toggle="collapse" data-parent="#navigation">Отображение данных <b class="caret"></b></a><div id="navigation-558" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-output-formatting.html">Форматирование данных</a>
<a class="list-group-item" href="./guide-output-pagination.html">Постраничная разбивка</a>
<a class="list-group-item" href="./guide-output-sorting.html">Сортировка</a>
<a class="list-group-item" href="./guide-output-data-providers.html">Провайдеры данных</a>
<a class="list-group-item" href="./guide-output-data-widgets.html">Виджеты для данных</a>
<a class="list-group-item" href="./guide-output-client-scripts.html">Работа с клиентскими скриптами</a>
<a class="list-group-item" href="./guide-output-theming.html">Темизация</a></div>
<a class="list-group-item active" href="#navigation-559" data-toggle="collapse" data-parent="#navigation">Безопасность <b class="caret"></b></a><div id="navigation-559" class="submenu panel-collapse collapse in"><a class="list-group-item" href="./guide-security-overview.html">Обзор</a>
<a class="list-group-item" href="./guide-security-authentication.html">Аутентификация</a>
<a class="list-group-item" href="./guide-security-authorization.html">Авторизация</a>
<a class="list-group-item" href="./guide-security-passwords.html">Работа с паролями</a>
<a class="list-group-item" href="./guide-security-cryptography.html">Криптография</a>
<a class="list-group-item" href="https://github.com/yiisoft/yii2-authclient/blob/master/docs/guide-ru/README.md">Клиенты авторизации</a>
<a class="list-group-item active" href="./guide-security-best-practices.html">Лучшие практики</a></div>
<a class="list-group-item" href="#navigation-560" data-toggle="collapse" data-parent="#navigation">Кеширование <b class="caret"></b></a><div id="navigation-560" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-caching-overview.html">Обзор</a>
<a class="list-group-item" href="./guide-caching-data.html">Кэширование данных</a>
<a class="list-group-item" href="./guide-caching-fragment.html">Кэширование фрагментов</a>
<a class="list-group-item" href="./guide-caching-page.html">Кэширование страниц</a>
<a class="list-group-item" href="./guide-caching-http.html">HTTP кэширование</a></div>
<a class="list-group-item" href="#navigation-561" data-toggle="collapse" data-parent="#navigation">Веб-сервисы REST <b class="caret"></b></a><div id="navigation-561" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-rest-quick-start.html">Быстрый старт</a>
<a class="list-group-item" href="./guide-rest-resources.html">Ресурсы</a>
<a class="list-group-item" href="./guide-rest-controllers.html">Контроллеры</a>
<a class="list-group-item" href="./guide-rest-routing.html">Роутинг</a>
<a class="list-group-item" href="./guide-rest-response-formatting.html">Форматирование ответа</a>
<a class="list-group-item" href="./guide-rest-authentication.html">Аутентификация</a>
<a class="list-group-item" href="./guide-rest-rate-limiting.html">Ограничение частоты запросов</a>
<a class="list-group-item" href="./guide-rest-versioning.html">Версионирование</a>
<a class="list-group-item" href="./guide-rest-error-handling.html">Обработка ошибок</a></div>
<a class="list-group-item" href="#navigation-562" data-toggle="collapse" data-parent="#navigation">Инструменты разработчика <b class="caret"></b></a><div id="navigation-562" class="submenu panel-collapse collapse"><a class="list-group-item" href="https://github.com/yiisoft/yii2-debug/blob/master/docs/guide/README.md">Отладочная панель и отладчик</a>
<a class="list-group-item" href="https://github.com/yiisoft/yii2-gii/blob/master/docs/guide/README.md">Генерация кода с Gii</a>
<a class="list-group-item" href="https://github.com/yiisoft/yii2-apidoc">Генератор документации API</a></div>
<a class="list-group-item" href="#navigation-563" data-toggle="collapse" data-parent="#navigation">Тестирование <b class="caret"></b></a><div id="navigation-563" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-test-overview.html">Обзор</a>
<a class="list-group-item" href="./guide-test-environment-setup.html">Настройка тестового окружения</a>
<a class="list-group-item" href="./guide-test-unit.html">Модульные тесты</a>
<a class="list-group-item" href="./guide-test-functional.html">Функциональные тесты</a>
<a class="list-group-item" href="./guide-test-acceptance.html">Приёмочные тесты</a>
<a class="list-group-item" href="./guide-test-fixtures.html">Фикстуры</a></div>
<a class="list-group-item" href="#navigation-564" data-toggle="collapse" data-parent="#navigation">Специальные темы <b class="caret"></b></a><div id="navigation-564" class="submenu panel-collapse collapse"><a class="list-group-item" href="https://github.com/yiisoft/yii2-app-advanced/blob/master/docs/guide/README.md">Шаблон приложения advanced</a>
<a class="list-group-item" href="./guide-tutorial-start-from-scratch.html">Создание приложения с нуля</a>
<a class="list-group-item" href="./guide-tutorial-console.html">Консольные команды</a>
<a class="list-group-item" href="./guide-tutorial-core-validators.html">Встроенные валидаторы</a>
<a class="list-group-item" href="./guide-tutorial-i18n.html">Интернационализация</a>
<a class="list-group-item" href="./guide-tutorial-mailing.html">Отправка почты</a>
<a class="list-group-item" href="./guide-tutorial-performance-tuning.html">Оптимизация производительности</a>
<a class="list-group-item" href="./guide-tutorial-shared-hosting.html">Окружение виртуального хостинга</a>
<a class="list-group-item" href="./guide-tutorial-template-engines.html">Шаблонизаторы</a>
<a class="list-group-item" href="./guide-tutorial-yii-integration.html">Работа со сторонним кодом</a>
<a class="list-group-item" href="./guide-tutorial-yii-as-micro-framework.html">Использование Yii в качестве микро-framework&#039;а</a></div>
<a class="list-group-item" href="#navigation-565" data-toggle="collapse" data-parent="#navigation">Виджеты <b class="caret"></b></a><div id="navigation-565" class="submenu panel-collapse collapse"><a class="list-group-item" href="http://www.yiiframework.com/doc-2.0/yii-grid-gridview.html">GridView</a>
<a class="list-group-item" href="http://www.yiiframework.com/doc-2.0/yii-widgets-listview.html">ListView</a>
<a class="list-group-item" href="http://www.yiiframework.com/doc-2.0/yii-widgets-detailview.html">DetailView</a>
<a class="list-group-item" href="http://www.yiiframework.com/doc-2.0/guide-input-forms.html#activerecord-based-forms-activeform">ActiveForm</a>
<a class="list-group-item" href="http://www.yiiframework.com/doc-2.0/yii-widgets-pjax.html">Pjax</a>
<a class="list-group-item" href="http://www.yiiframework.com/doc-2.0/yii-widgets-menu.html">Menu</a>
<a class="list-group-item" href="http://www.yiiframework.com/doc-2.0/yii-widgets-linkpager.html">LinkPager</a>
<a class="list-group-item" href="http://www.yiiframework.com/doc-2.0/yii-widgets-linksorter.html">LinkSorter</a>
<a class="list-group-item" href="https://github.com/yiisoft/yii2-bootstrap/blob/master/docs/guide-ru/README.md">Виджеты Bootstrap</a>
<a class="list-group-item" href="https://github.com/yiisoft/yii2-jui/blob/master/docs/guide-ru/README.md">Виджеты Jquery UI</a></div>
<a class="list-group-item" href="#navigation-566" data-toggle="collapse" data-parent="#navigation">Хелперы <b class="caret"></b></a><div id="navigation-566" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-helper-overview.html">Обзор</a>
<a class="list-group-item" href="./guide-helper-array.html">ArrayHelper</a>
<a class="list-group-item" href="./guide-helper-html.html">Html</a>
<a class="list-group-item" href="./guide-helper-url.html">Url хелпер</a></div></div>    </div>
    <div class="col-md-9 guide-content" role="main">
        <h1>Лучшие практики безопасности <span id="lucsie-praktiki-bezopasnosti"></span><a href="#lucsie-praktiki-bezopasnosti" class="hashlink">&para;</a></h1>
<div class="toc"><ol><li><a href="#osnovnye-principy">Основные принципы</a></li>
<li><a href="#kak-izbezat-sql-inekcij">Как избежать SQL-иньекций</a></li>
<li><a href="#kak-izbezat-xss">Как избежать XSS</a></li>
<li><a href="#kak-izbezat-csrf">Как избежать CSRF</a></li>
<li><a href="#kak-izbezat-nezelatelnogo-dostupa-k-fajlam">Как избежать нежелательного доступа к файлам</a></li>
<li><a href="#kak-izbezat-vyvoda-informacii-otladki-i-instrumentov-v-rabocem-rezime">Как избежать вывода информации отладки и инструментов в рабочем режиме</a></li>
<li><a href="#ispolzovanie-bezopasnogo-podklucenia-cerez-tls">Использование безопасного подключения через TLS</a></li>
<li><a href="#bezopasnaa-konfiguracia-servera">Безопасная конфигурация сервера</a></li></ol></div>
<p>Ниже мы рассмотрим основные принципы безопасности и опишем, как избежать угроз при разработке на Yii.</p>
<h2>Основные принципы <span id="osnovnye-principy"></span><a href="#osnovnye-principy" class="hashlink">&para;</a></h2><p>Есть два основных принципа безопасности, независимо от того, какое приложение разрабатывается:</p>
<ol>
<li>Фильтрация ввода.</li>
<li>Экранирование вывода.</li>
</ol>
<h3>Фильтрация ввода <span id="filtracia-vvoda"></span><a href="#filtracia-vvoda" class="hashlink">&para;</a></h3><p>Фильтрация ввода означает, что входные данные никогда не должны считаться безопасными и вы всегда должны проверять,
являются ли полученные данные допустимыми. Например, если мы знаем, что сортировка может быть осуществлена только
по трём полям <code>title</code>, <code>created_at</code> и <code>status</code>, и поле может передаваться через ввод пользователем, лучше проверить
значение там, где мы его получили:</p>
<pre><code class="hljs php language-php">$sortBy = $_GET[<span class="hljs-string">'sort'</span>];
<span class="hljs-keyword">if</span> (!in_array($sortBy, [<span class="hljs-string">'title'</span>, <span class="hljs-string">'created_at'</span>, <span class="hljs-string">'status'</span>])) {
	<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-keyword">Exception</span>(<span class="hljs-string">'Invalid sort value.'</span>);
}
</code></pre>
<p>В Yii, вы, скорее всего, будете использовать <a href="guide-input-validation.html">валидацию форм</a>, чтоб делать такие проверки.</p>
<h3>Экранирование вывода <span id="ekranirovanie-vyvoda"></span><a href="#ekranirovanie-vyvoda" class="hashlink">&para;</a></h3><p>Экранирование вывода означает, что данные в зависимости от контекста должны экранироваться, например в контексте
HTML вы должны экранировать <code>&lt;</code>, <code>&gt;</code> и похожие специальные символы. В контексте JavaScript или SQL будет другой набор
символов. Так как ручное экранирование чревато ошибками, Yii предоставляет различные утилиты для экранирования в
различных контекстах.</p>
<h2>Как избежать SQL-иньекций <span id="kak-izbezat-sql-inekcij"></span><a href="#kak-izbezat-sql-inekcij" class="hashlink">&para;</a></h2><p>SQL-иньекции происходят, когда текст запроса формируется склеиванием не экранированных строк, как показано ниже:</p>
<pre><code class="hljs php language-php">$username = $_GET[<span class="hljs-string">'username'</span>];
$sql = <span class="hljs-string">"SELECT * FROM user WHERE username = '$username'"</span>;
</code></pre>
<p>Вместо того, чтобы подставлять корректное имя пользователя, злоумышленник может передать вам в приложение что-то вроде
<code>'; DROP TABLE user; --</code>.
В результате SQL будет следующий:</p>
<pre><code class="hljs sql language-sql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">WHERE</span> username = <span class="hljs-string">''</span>; <span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">user</span>; <span class="hljs-comment">--'</span>
</code></pre>
<p>Это валидный запрос, который сначала будет искать пользователей с пустым именем, а затем удалит таблицу <code>user</code>.
Скорее всего будет сломано приложение и будут потеряны данные (вы ведь делаете регулярное резервное копирование?).</p>
<p>Большинство запросов к базе данных в Yii происходит через <a href="guide-db-active-record.html">Active Record</a>, который правильно
использует подготовленные запросы PDO внутри. При использовании подготовленных запросов невозможно манипулировать
запросом как это показано выше.</p>
<p>Тем не менее, иногда нужны <a href="guide-db-dao.html">сырые запросы</a> или <a href="guide-db-query-builder.html">построитель запросов</a>. В этом случае
вы должны использовать безопасные способы передачи данных. Если данные используются для сравнения со значением
столбцов предпочтительнее использовать подготовленные запросы:</p>
<pre><code class="hljs php language-php"><span class="hljs-comment">// query builder</span>
$userIDs = (<span class="hljs-keyword">new</span> Query())
    -&gt;select(<span class="hljs-string">'id'</span>)
    -&gt;from(<span class="hljs-string">'user'</span>)
    -&gt;where(<span class="hljs-string">'status=:status'</span>, [<span class="hljs-string">':status'</span> =&gt; $status])
    -&gt;all();

<span class="hljs-comment">// DAO</span>
$userIDs = $connection
    -&gt;createCommand(<span class="hljs-string">'SELECT id FROM user where status=:status'</span>)
    -&gt;bindValues([<span class="hljs-string">':status'</span> =&gt; $status])
    -&gt;queryColumn();
</code></pre>
<p>Если данные используются в качестве имён столбцов или таблиц, то лучший путь - это разрешить только предопределённый
набор значений:</p>
<pre><code class="hljs php language-php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">actionList</span><span class="hljs-params">($orderBy = null)</span>
</span>{
    <span class="hljs-keyword">if</span> (!in_array($orderBy, [<span class="hljs-string">'name'</span>, <span class="hljs-string">'status'</span>])) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> BadRequestHttpException(<span class="hljs-string">'Only name and status are allowed to order by.'</span>)
    }
    
    <span class="hljs-comment">// ...</span>
}
</code></pre>
<p>Если это невозможно, то имена столбцов и таблиц должны экранироваться. Yii использует специальный синтаксис
для экранирования для всех поддерживаемых баз данных:</p>
<pre><code class="hljs php language-php">$sql = <span class="hljs-string">"SELECT COUNT([[$column]]) FROM {{table}}"</span>;
$rowCount = $connection-&gt;createCommand($sql)-&gt;queryScalar();
</code></pre>
<p>Вы можете получить подробную информацию о синтаксисе в <a href="guide-db-dao.html#quoting-table-and-column-names">Экранирование имён таблиц и столбцов</a>.</p>
<h2>Как избежать XSS <span id="kak-izbezat-xss"></span><a href="#kak-izbezat-xss" class="hashlink">&para;</a></h2><p>XSS или кросс-сайтинговый скриптинг становится возможен, когда не экранированный выходной HTML попадает в браузер.
Например, если пользователь должен ввести своё имя, но вместо <code>Alexander</code> он вводит <code>&lt;script&gt;alert('Hello!');&lt;/script&gt;</code>, то
все страницы, которые его выводят без экранирования, будут выполнять JavaScript <code>alert('Hello!');</code>, и в результате
будет выводиться окно сообщения в браузере. В зависимости от сайта, вместо невинных скриптов с выводом всплывающего
hello, злоумышленниками могут быть отправлены скрипты, похищающие личные данные пользователей сайта,
либо выполняющие операции от их имени.</p>
<p>В Yii избежать XSS легко. На месте вывода текста необходимо выбрать один из двух вариантов:</p>
<ol>
<li>Вы хотите вывести данные в виде обычного текста.</li>
<li>Вы хотите вывести данные в виде HTML.</li>
</ol>
<p>Если вам нужно вывести простой текст, то экранировать лучше следующим образом:</p>
<pre><code class="hljs php language-php"><span class="hljs-meta">&lt;?</span>= \yii\helpers\Html::encode($username) <span class="hljs-meta">?&gt;</span>
</code></pre>
<p>Если нужно вывести HTML, вам лучше воспользоваться HtmlPurifier:</p>
<pre><code class="hljs php language-php"><span class="hljs-meta">&lt;?</span>= \yii\helpers\HtmlPurifier::process($description) <span class="hljs-meta">?&gt;</span>
</code></pre>
<p>Обратите внимание, что обработка с помощью HtmlPurifier довольно тяжела, так что неплохо бы задуматься о кешировании.</p>
<h2>Как избежать CSRF <span id="kak-izbezat-csrf"></span><a href="#kak-izbezat-csrf" class="hashlink">&para;</a></h2><p>CSRF - это аббревиатура для межсайтинговой подмены запросов. Идея заключается в том, что многие приложения предполагают,
что запросы, приходящие от браузера, отправляются самим пользователем. Это может быть неправдой.</p>
<p>Например, сайт <code>an.example.com</code> имеет URL <code>/logout</code>, который, используя простой GET, разлогинивает пользователя. Пока
это запрос выполняется самим пользователем - всё в порядке, но в один прекрасный день злоумышленники размещают код
<code>&lt;img src="http://an.example.com/logout"&gt;</code> на форуме с большой посещаемостью. Браузер не делает никаких отличий
между запросом изображения и запросом страницы, так что когда пользователь откроет страницу с таким тегом <code>img</code>, браузер отправит GET запрос на указанный адрес, и пользователь будет разлогинен.</p>
<p>Вот основная идея. Можно сказать, что в разлогировании пользователя нет ничего серьёзного, но с помощью этой уязвимости, можно выполнять опасные операции. Представьте, что существует страница <a href="http://an.example.com/purse/transfer?to=anotherUser&amp;amount=2000">http://an.example.com/purse/transfer?to=anotherUser&amp;amount=2000</a>, обращение к которой с помощью GET запроса, приводит к перечислению 2000 единиц валюты со счета авторизированного пользователя на счет пользователя с логином anotherUser. Учитывая, что браузер для загрузки контента отправляет GET запросы, можно подумать, что разрешение на выполнение такой операции только POST запросом на 100% обезопасит от проблем. К сожалению, это не совсем правда. Учитывайте, что вместо тега <img>, злоумышленник может внедрить JavaScript код, который будет отправлять нужные POST запросы на этот URL.</p>
<p>Для того, чтоб избежать CSRF вы должны всегда:</p>
<ol>
<li>Следуйте спецификациям HTTP, например запрос GET не должен менять состояние приложения.</li>
<li>Держите защиту CSRF в Yii включенной.</li>
</ol>
<h2>Как избежать нежелательного доступа к файлам <span id="kak-izbezat-nezelatelnogo-dostupa-k-fajlam"></span><a href="#kak-izbezat-nezelatelnogo-dostupa-k-fajlam" class="hashlink">&para;</a></h2><p>По умолчанию, webroot сервера указывает на каталог <code>web</code>, где лежит <code>index.php</code>. В случае использования виртуального
хостинга, это может быть недостижимо, в конечном итоге весь код, конфиги и логи могут оказаться в webroot сервера.</p>
<p>Если это так, то нужно запретить доступ ко всему, кроме директории <code>web</code>. Если на вашем хостинге такое невозможно,
рассмотрите возможность смены хостинга.</p>
<h2>Как избежать вывода информации отладки и инструментов в рабочем режиме <span id="kak-izbezat-vyvoda-informacii-otladki-i-instrumentov-v-rabocem-rezime"></span><a href="#kak-izbezat-vyvoda-informacii-otladki-i-instrumentov-v-rabocem-rezime" class="hashlink">&para;</a></h2><p>В режиме отладки, Yii отображает довольно подробные ошибки, которые полезны во время разработки. Дело в том, что
подробные ошибки удобны для нападающего, так как могут раскрыть структуру базы данных, параметров конфигурации и части
вашего кода. Никогда не запускайте приложения в рабочем режиме с <code>YII_DEBUG</code> установленным в <code>true</code> в вашем <code>index.php</code>.</p>
<p>Вы никогда не должны включать Gii или Debug панель в рабочем режиме. Это может быть использованно для получения информации о структуре базы данных, кода и может позволить заменить файлы, генерируемые Gii автоматически.</p>
<p>Следует избегать включения в рабочем режиме панели отладки, если только в этом нет острой необходимости.
Она раскрывает всё приложение и детали конфигурации. Если Вам всё-таки нужно запустить панель отладки в рабочем режиме,
проверьте дважды, что доступ ограничен только вашими IP-адресами.</p>
<p>Далее по теме читайте:</p>
<ul>
<li><a href="https://www.owasp.org/index.php/Exception_Handling">https://www.owasp.org/index.php/Exception_Handling</a></li>
<li><a href="https://www.owasp.org/index.php/Top_10_2007-Information_Leakage">https://www.owasp.org/index.php/Top_10_2007-Information_Leakage</a></li>
</ul>
<h2>Использование безопасного подключения через TLS <span id="ispolzovanie-bezopasnogo-podklucenia-cerez-tls"></span><a href="#ispolzovanie-bezopasnogo-podklucenia-cerez-tls" class="hashlink">&para;</a></h2><p>Yii предоставляет функции, которые зависят от куки-файлов и/или сессий PHP. Они могут быть уязвимыми, если Ваше соединение
скомпрометированно. Риск снижается, если приложение использует безопасное соединение через TLS (часто называемое как <a href="https://en.wikipedia.org/wiki/Transport_Layer_Security">SSL</a>).</p>
<p>Инструкции по настройке смотрите в документации к Вашему веб-серверу. Вы также можете проверить примеры конфигураций
предоставленные проектом H5BP:</p>
<ul>
<li><a href="https://github.com/h5bp/server-configs-nginx">Nginx</a></li>
<li><a href="https://github.com/h5bp/server-configs-apache">Apache</a>.</li>
<li><a href="https://github.com/h5bp/server-configs-iis">IIS</a>.</li>
<li><a href="https://github.com/h5bp/server-configs-lighttpd">Lighttpd</a>.</li>
</ul>
<h2>Безопасная конфигурация сервера <span id="bezopasnaa-konfiguracia-servera"></span><a href="#bezopasnaa-konfiguracia-servera" class="hashlink">&para;</a></h2><p>Цель этого раздела - выявить риски, которые необходимо учитывать при создании
конфигурации сервера для обслуживания веб-сайта на основе Yii. Помимо перечисленных здесь пунктов есть и
другие параметры, связанные с безопасностью, которые необходимо учитывать, поэтому не рассматривайте этот раздел как завершенный.</p>
<h3>Как избежать атаки типа <code>Host</code>-header <span id="kak-izbezat-ataki-tipa-host-header"></span><a href="#kak-izbezat-ataki-tipa-host-header" class="hashlink">&para;</a></h3><p>Классы типа <a href="./yii-web-urlmanager.html">yii\web\UrlManager</a> и <a href="./yii-helpers-url.html">yii\helpers\Url</a> могут использовать <a href="./yii-web-request.html#getHostInfo()-detail">запрашиваемое имя хоста</a>] для генерации ссылок. Если веб-сервер настроен на обслуживание одного и того же сайта независимо от значения заголовка <code>Host</code>, эта информация может быть ненадежной и может быть подделана пользователем, отправляющим HTTP-запрос. В таких ситуациях Вы должны либо исправить конфигурацию своего веб-сервера, чтобы обслуживать сайт только для указанных имен узлов, либо явно установить или отфильтровать значение, установив свойство <a href="./yii-web-request.html#setHostInfo()-detail">hostInfo</a> компонента приложения <code>request</code>.</p>
<p>Дополнительные сведения о конфигурации сервера смотрите в документации Вашего веб-сервера:</p>
<ul>
<li>Apache 2: <a href="http://httpd.apache.org/docs/trunk/vhosts/examples.html#defaultallports">http://httpd.apache.org/docs/trunk/vhosts/examples.html#defaultallports</a></li>
<li>Nginx: <a href="https://www.nginx.com/resources/wiki/start/topics/examples/server_blocks/">https://www.nginx.com/resources/wiki/start/topics/examples/server_blocks/</a></li>
</ul>
<p>Если у Вас нет доступа к конфигурации сервера, Вы можете настроить фильтр <a href="./yii-filters-hostcontrol.html">yii\filters\HostControl</a> уровня приложения для защиты от такого рода атак:</p>
<pre><code class="hljs php language-php"><span class="hljs-comment">// Файл конфигурации веб-приложения</span>
<span class="hljs-keyword">return</span> [
    <span class="hljs-string">'as hostControl'</span> =&gt; [
        <span class="hljs-string">'class'</span> =&gt; <span class="hljs-string">'yii\filters\HostControl'</span>,
        <span class="hljs-string">'allowedHosts'</span> =&gt; [
            <span class="hljs-string">'example.com'</span>,
            <span class="hljs-string">'*.example.com'</span>,
        ],
        <span class="hljs-string">'fallbackHostInfo'</span> =&gt; <span class="hljs-string">'https://example.com'</span>,
    ],
    <span class="hljs-comment">// ...</span>
];
</code></pre>
<blockquote class="note"><p><strong>Примечание: </strong>Вы всегда должны предпочесть конфигурацию веб-сервера для защиты от <code>атак заголовков узла</code> вместо использования фильтра.</p>
<pre><code class="hljs css"><span class="hljs-selector-attr">[[yii\filters\HostControl]</span>] следует использовать, только если настройка конфигурации сервера недоступна.
</code></pre>
</blockquote>
        <div class="toplink"><a href="#" class="h1" title="go to top"><span class="glyphicon glyphicon-arrow-up"></a></div>
    </div>
</div>


</div>

<footer class="footer">
        <p class="pull-right"><small>Page generated on Wed, 09 Dec 2020 00:16:04 +0000</small></p>
    Powered by <a href="http://www.yiiframework.com/" rel="external">Yii Framework</a></footer>

<script>jQuery(function ($) {
    var shiftWindow = function () { scrollBy(0, -50) };
    if (location.hash) setTimeout(shiftWindow, 1);
    window.addEventListener("hashchange", shiftWindow);
var element = document.createElement("script");
element.src = "./jssearch.index.js";
document.body.appendChild(element);

var searchBox = $('#searchbox');

// search when typing in search field
searchBox.on("keyup", function(event) {
    var query = $(this).val();

    if (query == '' || event.which == 27) {
        $('#search-resultbox').hide();
        return;
    } else if (event.which == 13) {
        var selectedLink = $('#search-resultbox a.selected');
        if (selectedLink.length != 0) {
            document.location = selectedLink.attr('href');
            return;
        }
    } else if (event.which == 38 || event.which == 40) {
        $('#search-resultbox').show();

        var selected = $('#search-resultbox a.selected');
        if (selected.length == 0) {
            $('#search-results').find('a').first().addClass('selected');
        } else {
            var next;
            if (event.which == 40) {
                next = selected.parent().next().find('a').first();
            } else {
                next = selected.parent().prev().find('a').first();
            }
            if (next.length != 0) {
                var resultbox = $('#search-results');
                var position = next.position();

//              TODO scrolling is buggy and jumps around
//                resultbox.scrollTop(Math.floor(position.top));
//                console.log(position.top);

                selected.removeClass('selected');
                next.addClass('selected');
            }
        }

        return;
    }
    $('#search-resultbox').show();
    $('#search-results').html('<li><span class="no-results">No results</span></li>');

    var result = jssearch.search(query);

    if (result.length > 0) {
        var i = 0;
        var resHtml = '';

        for (var key in result) {
            if (i++ > 20) {
                break;
            }
            resHtml = resHtml +
            '<li><a href="' + result[key].file.u.substr(3) +'"><span class="title">' + result[key].file.t + '</span>' +
            '<span class="description">' + result[key].file.d + '</span></a></li>';
        }
        $('#search-results').html(resHtml);
    }
});

// hide the search results on ESC
$(document).on("keyup", function(event) { if (event.which == 27) { $('#search-resultbox').hide(); } });
// hide search results on click to document
$(document).bind('click', function (e) { $('#search-resultbox').hide(); });
// except the following:
searchBox.bind('click', function(e) { e.stopPropagation(); });
$('#search-resultbox').bind('click', function(e) { e.stopPropagation(); });

});</script></body>
</html>
